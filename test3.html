<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FCM Test</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    button {
      background: #1da1f2;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      color: white;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 20px;
    }
  </style>
</head>
<body>

<h1>ðŸ”¥ Firebase Cloud Messaging Test</h1>
<p id="status">Initializing...</p>
<button id="requestPermissionBtn">Enable Notifications</button>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/11.4.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.4.0/firebase-messaging-compat.js"></script>

<script>
  // Initialize Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
    authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
    projectId: "itzhoyoo-f9f7e",
    messagingSenderId: "1094792075584",
    appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5"
  };
  firebase.initializeApp(firebaseConfig);

  const messaging = firebase.messaging();
  const statusEl = document.getElementById('status');
  const btn = document.getElementById('requestPermissionBtn');

  navigator.serviceWorker.register('/firebase-messaging-sw.js')
    .then((registration) => {
      console.log('âœ… Service Worker registered');
      messaging.useServiceWorker(registration);

      btn.addEventListener('click', async () => {
        try {
          await Notification.requestPermission();
          if (Notification.permission === 'granted') {
            const token = await messaging.getToken({
              vapidKey: 'AK-6m_S0RReUO_QiiA97EnON7prWP7cPrNSRFemVRkM'
            });
            console.log('âœ… Token:', token);
            statusEl.textContent = 'âœ… Notifications enabled. Token in console.';
          } else {
            statusEl.textContent = 'âŒ Permission denied.';
          }
        } catch (err) {
          console.error('âŒ Error getting token:', err);
          statusEl.textContent = 'âŒ Error getting token. See console.';
        }
      });

      statusEl.textContent = 'Ready to request permission.';
    })
    .catch((err) => {
      console.error('âŒ Service Worker registration failed:', err);
      statusEl.textContent = 'âŒ SW registration failed.';
    });

  // Handle foreground messages
  messaging.onMessage((payload) => {
    console.log('ðŸ“© Foreground message:', payload);
    alert(`ðŸ“¬ ${payload.notification?.title || 'Notification'}\n${payload.notification?.body || ''}`);
  });
</script>

</body>
</html>