<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProPush Stats Dashboard</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f4f7f6; padding: 20px; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h2 { color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .controls { display: flex; gap: 10px; margin-bottom: 20px; align-items: flex-end; flex-wrap: wrap; }
        .input-group { display: flex; flex-direction: column; }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; height: 38px; }
        button:hover { background: #0056b3; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; }
        th { background: #f8f9fa; }
        .loading { color: #666; font-style: italic; }
        .error { color: #d9534f; background: #fdf7f7; padding: 10px; border-radius: 4px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ProPush.me Statistics</h2>
    
    <div class="controls">
        <div class="input-group">
            <label>API Token:</label>
            <input type="password" id="apiKey" value="230d888eee00b98cdd814f24c4d766199fe94513f3975519" style="width: 350px;">
        </div>
        <div class="input-group">
            <label>From:</label>
            <input type="date" id="dateFrom">
        </div>
        <div class="input-group">
            <label>To:</label>
            <input type="date" id="dateTo">
        </div>
        <button onclick="fetchStats()">Get Stats</button>
    </div>

    <div id="status"></div>
    
    <table id="statsTable" style="display:none;">
        <thead>
            <tr id="tableHeader">
                </tr>
        </thead>
        <tbody id="tableBody">
            </tbody>
    </table>
</div>

<script>
    // Set default dates (last 7 days)
    const today = new Date().toISOString().split('T')[0];
    const lastWeek = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
    document.getElementById('dateTo').value = today;
    document.getElementById('dateFrom').value = lastWeek;

    async function fetchStats() {
        const token = document.getElementById('apiKey').value;
        const from = document.getElementById('dateFrom').value;
        const to = document.getElementById('dateTo').value;
        const status = document.getElementById('status');
        const table = document.getElementById('statsTable');
        const tbody = document.getElementById('tableBody');
        const thead = document.getElementById('tableHeader');

        if (!token) { alert("Please enter your API token"); return; }

        status.innerHTML = '<p class="loading">Fetching data from ProPush API...</p>';
        table.style.display = 'none';
        tbody.innerHTML = '';
        thead.innerHTML = '';

        try {
            // Endpoints: https://api.propush.me/v5/pub/statistics
            const url = `https://api.propush.me/v5/pub/statistics?date_from=${from}&date_to=${to}&group_by[]=date&group_by[]=zone_id`;
            
            const response = await fetch(url, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Accept': 'application/json'
                }
            });

            const result = await response.json();

            if (!response.ok) {
                throw new Error(result.message || "Failed to fetch data");
            }

            const rows = result.rows || [];
            
            if (rows.length === 0) {
                status.innerHTML = '<p>No data found for this period.</p>';
                return;
            }

            // Create Headers based on first row keys
            const keys = Object.keys(rows[0]);
            keys.forEach(key => {
                const th = document.createElement('th');
                th.textContent = key.replace('_', ' ').toUpperCase();
                thead.appendChild(th);
            });

            // Fill Table
            rows.forEach(row => {
                const tr = document.createElement('tr');
                keys.forEach(key => {
                    const td = document.createElement('td');
                    td.textContent = row[key];
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });

            status.innerHTML = '';
            table.style.display = 'table';

        } catch (err) {
            status.innerHTML = `<div class="error">Error: ${err.message}</div>`;
        }
    }
</script>

</body>
</html>
