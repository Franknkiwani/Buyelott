 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CyberChat - Posts</title>
<style>
  body {
  margin: 0;
  background-color: #000;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  color: #ddd;
}
header {
  background-color: #0a0a0a;
  padding: 0.8rem 1.2rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 1000;
}
.logo {
  font-size: 1.2rem;
  font-weight: bold;
  color: #fff;
}
.timer {
  font-size: 1.2rem;
  font-weight: normal;
  color: #0af;
  font-variant-numeric: tabular-nums;
  letter-spacing: 0.05em;
  font-family: monospace, 'Segoe UI', sans-serif;
}
.header-line {
  height: 2px;
  background-color: #0af;
  width: 100%;
  margin: 0;
}
.search-container {
  background-color: #0a0a0a;
  padding: 1rem 1.5rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.8rem;
  border-bottom: 1px solid #111;
  position: sticky;
  top: 54px; /* height of header */
  z-index: 999;
}
input[type="search"] {
  background-color: #121212;
  border: 2.5px solid #0af;
  border-radius: 10px;
  color: #eee;
  padding: 0.6rem 1rem;
  font-size: 1.1rem;
  width: 320px;
  outline: none;
  transition: border-color 0.3s ease, box-shadow 0.3s ease;
}
input[type="search"]::placeholder {
  color: #55aaff99;
}
input[type="search"]:focus {
  border-color: #0af;
  box-shadow: 0 0 12px #0af88;
  background-color: #1c1c1c;
}
.posts-container {
  padding: 1rem 1.5rem;
  max-width: 900px;
  margin: auto;
}
.post {
  position: relative;
  background-color: #121212;
  border-radius: 12px;
  padding: 1rem;
  margin-bottom: 1rem;
  box-shadow: 0 0 10px #0af6;
  display: flex;
  gap: 1rem;
  color: #ccc;
}
.views-button {
  position: absolute;
  top: 10px;
  left: 10px;
  background-color: cyan;
  color: black;
  font-weight: 600;
  font-size: 0.7rem;
  padding: 0.2rem 0.5rem;
  border-radius: 6px;
  user-select: none;
  pointer-events: none;
  font-family: monospace, sans-serif;
}
.post img {
  width: 160px;
  height: 100px;
  object-fit: cover;
  border-radius: 10px;
  flex-shrink: 0;
  box-shadow: 0 0 8px #0af6;
}
.post-content {
  flex: 1;
  display: flex;
  flex-direction: column;
}
.post-title {
  font-size: 1.3rem;
  font-weight: bold;
  color: #0af;
  margin: 0 0 0.3rem 0;
}
.post-description {
  font-style: italic;
  color: #66cceeaa;
  margin: 0 0 0.6rem 0;
}
.post-fullcontent {
  font-size: 0.9rem;
  line-height: 1.4;
  color: #ddd;
  white-space: pre-wrap;
  overflow-wrap: break-word;
  margin-bottom: 0.5rem;
}
.view-post-btn {
  align-self: flex-start;
  padding: 0.35rem 0.8rem;
  border: none;
  border-radius: 8px;
  background-color: #0af;
  color: #000;
  font-weight: bold;
  font-size: 0.9rem;
  cursor: pointer;
  transition: background-color 0.3s ease;
  user-select: none;
}
.view-post-btn:hover {
  background-color: #07c;
  color: #e0e0e0;
}
.no-posts {
  color: #555;
  text-align: center;
  padding: 2rem;
}
button {
  user-select: none;       /* Prevent text selection */
  -webkit-tap-highlight-color: transparent;  /* Remove blue highlight on mobile */
  outline: none;           /* Remove focus outline (optional) */
}
.view-post-btn {
  user-select: none;
  -webkit-tap-highlight-color: transparent;
  outline: none;
}
button, .view-post-btn {
  -webkit-user-select: none;  /* Safari and Chrome */
  -moz-user-select: none;     /* Firefox */
  -ms-user-select: none;      /* IE/Edge */
  user-select: none;          /* Standard */

  -webkit-tap-highlight-color: transparent; /* Remove blue highlight on iOS/Android */

  outline: none; /* Optional: removes focus outline */
}
/* Disable text selection on elements */
.some-selector {
  -webkit-user-select: none; /* Chrome, Safari, newer Edge */
  -moz-user-select: none;    /* Firefox */
  -ms-user-select: none;     /* IE10+ */
  user-select: none;         /* Standard */
}
/* Disable text selection on the whole page */
body {
  user-select: none;
  -webkit-user-select: none; /* Safari */
  -moz-user-select: none;    /* Firefox */
  -ms-user-select: none;     /* IE10+ */
}
</style>
</head>
<body>
  <header>
    <div class="logo">CYBERCHAT</div>
    <div class="timer" id="timer">--:--:--</div>
  </header>
  <hr class="header-line" />

  <div class="search-container">
    <input type="search" id="searchInput" placeholder="Search posts by title..." autocomplete="off" />
  </div>

  <div class="posts-container" id="postsContainer">
    Loading posts...
  </div>
</div>
<script type="module">    
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";    
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-analytics.js";    
  import { getDatabase, ref, get, update, onValue } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";    
  import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";    
    
  const firebaseConfig = {    
    apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",    
    authDomain: "itzhoyoo-f9f7e.firebaseapp.com",    
    databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",    
    projectId: "itzhoyoo-f9f7e",    
    storageBucket: "itzhoyoo-f9f7e.firebasestorage.app",    
    messagingSenderId: "1094792075584",    
    appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5",    
    measurementId: "G-LLT6F9WRKH"    
  };    
    
  const app = initializeApp(firebaseConfig);    
  getAnalytics(app);    
  const db = getDatabase(app);    
  const auth = getAuth(app);    
    
  const timerEl = document.getElementById('timer');    
  function updateTime() {    
    const now = new Date();    
    const h = now.getHours().toString().padStart(2, '0');    
    const m = now.getMinutes().toString().padStart(2, '0');    
    const s = now.getSeconds().toString().padStart(2, '0');    
    timerEl.textContent = `${h}:${m}:${s}`;    
  }    
  updateTime();    
  setInterval(updateTime, 1000);    
    
  const postsContainer = document.getElementById('postsContainer');    
  const searchInput = document.getElementById('searchInput');    
    
  let posts = [];    
    
  function sanitize(text) {    
    const div = document.createElement('div');    
    div.textContent = text;    
    return div.innerHTML;    
  }    
  function truncateText(text, maxLen) {    
    if (!text) return "";    
    return text.length > maxLen ? text.slice(0, maxLen) + "..." : text;    
  }    
  function shuffleArray(arr) {    
    for (let i = arr.length - 1; i > 0; i--) {    
      const j = Math.floor(Math.random() * (i + 1));    
      [arr[i], arr[j]] = [arr[j], arr[i]];    
    }    
  }    
    
  function renderPosts(list) {    
    if (list.length === 0) {    
      postsContainer.innerHTML = `<div class="no-posts">No posts found.</div>`;    
      return;    
    }    
    postsContainer.innerHTML = list.map(post => `    
      <article class="post" data-id="${sanitize(post.id)}">    
        <button class="views-button" id="views-${sanitize(post.id)}">views: 0</button>    
        <img src="${sanitize(post.image || '')}" alt="${sanitize(post.title)}" />    
        <div class="post-content">    
          <h2 class="post-title">${sanitize(truncateText(post.title, 7))}</h2>    
          <p class="post-description">${sanitize(truncateText(post.description, 15))}</p>    
          <div class="post-fullcontent" style="display:none;">${sanitize(post.content || '')}</div>    
          <button class="view-post-btn" type="button">View Post</button>    
        </div>    
      </article>    
    `).join('');    
  }    
    
  const viewListeners = new Map();    
  function subscribeViews(postsList) {    
    for (const [postId, unsubscribe] of viewListeners) {    
      unsubscribe();    
    }    
    viewListeners.clear();    
    
    postsList.forEach(post => {    
      const viewsRef = ref(db, `posts/${post.id}/views`);    
      const unsubscribe = onValue(viewsRef, (snapshot) => {    
        const views = snapshot.val() || 0;    
        const btn = document.getElementById(`views-${post.id}`);    
        if (btn) btn.textContent = `views: ${views}`;    
      });    
      viewListeners.set(post.id, unsubscribe);    
    });    
  }    
    
  // This will increment views ON EACH PAGE LOAD for all posts (no sessionStorage guard)    
  async function incrementViews(postsList) {    
    const promises = postsList.map(post => {    
      const viewsRef = ref(db, `posts/${post.id}/views`);    
      return get(viewsRef).then(snapshot => {    
        const current = snapshot.val() || 0;    
        return update(ref(db, `posts/${post.id}`), { views: current + 1 });    
      });    
    });    
    await Promise.all(promises);    
  }    
    
  async function loadPosts(userId) {    
    postsContainer.textContent = 'Loading posts...';    
    const postsRef = ref(db, 'posts');    
    try {    
      const snapshot = await get(postsRef);    
      if (!snapshot.exists()) {    
        posts = [];    
        postsContainer.innerHTML = `<div class="no-posts">No posts available.</div>`;    
        return;    
      }    
      const data = snapshot.val();    
      posts = Object.entries(data).map(([id, post]) => ({    
        id,    
        title: post.title || "Untitled",    
        image: post.image || "",    
        description: post.description || "",    
        content: post.content || ""    
      }));    
      shuffleArray(posts);    
      renderPosts(posts);    
      subscribeViews(posts);    
      await incrementViews(posts);    
      attachViewPostHandlers();    
    } catch (err) {    
      postsContainer.innerHTML = `<div class="no-posts">Error loading posts: ${sanitize(err.message)}</div>`;    
    }    
  }    
    
  searchInput.addEventListener('input', () => {    
    const term = searchInput.value.trim();    
    if (!term) {    
      renderPosts(posts);    
      subscribeViews(posts);    
      attachViewPostHandlers();    
      return;    
    }    
    const lowerTerm = term.toLowerCase();    
    const filtered = posts.filter(post => post.title.toLowerCase().includes(lowerTerm));    
    renderPosts(filtered);    
    subscribeViews(filtered);    
    attachViewPostHandlers();    
  });    
    
  signInAnonymously(auth)    
    .then(() => {    
      const user = auth.currentUser;    
      if (user) {    
        loadPosts(user.uid);    
      }    
    })    
    .catch(err => {    
      postsContainer.innerHTML = `<div class="no-posts">Authentication error: ${sanitize(err.message)}</div>`;    
    });    
    
  // Rewarded ad modal elements    
  const modalHTML = `    
    <div id="rewardedAdModal" style="    
      position: fixed; top:0; left:0; right:0; bottom:0;    
      background: rgba(0,0,0,0.85);    
      display: flex;    
      justify-content: center;    
      align-items: center;    
      z-index: 9999;    
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;    
      color: #0ff;    
    ">    
      <div style="background:#111; border: 3px solid #0ff; border-radius: 16px; padding: 2rem; max-width: 320px; text-align:center; box-shadow: 0 0 20px #0ff;">    
        <h2 style="margin-top:0; margin-bottom:1rem; font-weight: 700;">Watch Ad to View Post</h2>    
        <p style="margin-bottom:1.5rem; font-size: 1.1rem; color:#66ffffcc;">Please watch a short ad to unlock the full content.</p>    
        <button id="watchAdBtn" style="    
          background:#0ff; color:#000; font-weight: bold; border:none;    
          padding: 0.7rem 1.5rem; border-radius: 12px; cursor: pointer;    
          font-size: 1rem; margin-bottom: 1rem;    
        ">Watch Ad</button><br/>    
        <button id="cancelAdBtn" style="    
          background:#222; color:#0ff; font-weight: bold; border: 2px solid #0ff;    
          padding: 0.5rem 1.2rem; border-radius: 12px; cursor: pointer;    
          font-size: 0.9rem;    
        ">Cancel</button>    
        <div id="adCountdown" style="font-size: 1.3rem; margin-top: 1rem; display:none;">3</div>    
      </div>    
    </div>    
  `;    
    
  // Append modal to body, initially hidden      
  const modalContainer = document.createElement('div');      
  modalContainer.innerHTML = modalHTML;      
  document.body.appendChild(modalContainer);      
  const modal = document.getElementById('rewardedAdModal');      
  const watchAdBtn = document.getElementById('watchAdBtn');      
  const cancelAdBtn = document.getElementById('cancelAdBtn');      
  const adCountdown = document.getElementById('adCountdown');      
      
  modal.style.display = 'none';      
      
  let currentPostContentDiv = null;      
      
  function showModal(postContentDiv) {      
  currentPostContentDiv = postContentDiv;      
  modal.style.display = 'flex';      
  adCountdown.style.display = 'none';      
  watchAdBtn.style.display = 'inline-block';      
  cancelAdBtn.style.display = 'inline-block';      
  watchAdBtn.disabled = false;      
  cancelAdBtn.disabled = false;      
}      
      
function hideModal() {      
  modal.style.display = 'none';      
  currentPostContentDiv = null;      
}      
      
watchAdBtn.onclick = () => {      
  watchAdBtn.disabled = true;      
  cancelAdBtn.disabled = true;      
  let countdown = 3;      
  adCountdown.textContent = countdown;      
  adCountdown.style.display = 'block';      
      
  const interval = setInterval(() => {      
    countdown--;      
    adCountdown.textContent = countdown;      
    if (countdown <= 0) {      
      clearInterval(interval);      
      hideModal();      
      // Show full post content      
      if (currentPostContentDiv) {      
        currentPostContentDiv.style.display = 'block';      
        // Optionally scroll to content      
        currentPostContentDiv.scrollIntoView({behavior: 'smooth', block: 'center'});      
      }      
    }      
  }, 1000);      
};      
      
cancelAdBtn.onclick = () => {      
  hideModal();      
};      
    
function attachViewPostHandlers() {      
  document.querySelectorAll('.view-post-btn').forEach(button => {      
    button.onclick = (e) => {      
      const postEl = e.target.closest('.post');      
      if (!postEl) return;      
      const fullContentDiv = postEl.querySelector('.post-fullcontent');      
      if (!fullContentDiv) return;      
      
      if (fullContentDiv.style.display === 'block') {      
        // Already visible, maybe collapse or do nothing      
        fullContentDiv.style.display = 'none';      
        button.textContent = 'View Post';      
      } else {      
        // Show rewarded ad confirmation first      
        showModal(fullContentDiv);      
        button.textContent = 'Hide Post';      
      }      
    };      
  });      
}    

</script>  
</body>
</html>