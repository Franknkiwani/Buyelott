<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UEFA Style Tournament Table</title>
  <style>
    body {
      background: #121212;
      color: #eee;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
        Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      margin: 0;
      padding: 10px;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    h2 {
      margin: 24px 0 12px;
      font-weight: 700;
      border-bottom: 2px solid #444;
      padding-bottom: 6px;
      font-size: 1.3rem;
    }
    .table-wrapper {
      overflow-x: auto;
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 320px;
    }
    th, td {
      text-align: center;
      padding: 10px 6px;
      border: 1px solid #333;
      font-weight: 600;
      font-size: 0.9rem;
    }
    th {
      background: #222;
    }
    td {
      background: #1a1a1a;
    }
    tr:nth-child(even) td {
      background: #222;
    }
    section.stage {
      margin-top: 36px;
    }
    .match {
      background: #222;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 12px 16px;
      margin: 10px 0;
      display: flex;
      justify-content: space-between;
      font-weight: 600;
      font-size: 1.05rem;
      color: #ccc;
    }
    .match .date {
      font-weight: 400;
      font-size: 0.85rem;
      color: #666;
    }
    .lock-msg {
      color: #a00;
      font-weight: 700;
      font-size: 1.1rem;
      margin-top: 16px;
      text-align: center;
    }
    .locked .match {
      color: #555 !important;
      background: #111 !important;
      pointer-events: none;
    }
    @media (min-width: 600px) {
      th, td {
        font-size: 1rem;
        padding: 12px 10px;
      }
      .match {
        font-size: 1.2rem;
      }
    }

  </style>
</head>
<body>

  <div id="tournament-stage"></div>
<style>
  /* Group Table Styling */
  .table-wrapper {
    overflow-x: auto;
    margin-bottom: 30px;
  }
  .group-table {
    width: 100%;
    border-collapse: collapse;
    color: #eee;
    background: #121212;
  }
  .group-table th, .group-table td {
    padding: 8px 12px;
    border: 1px solid #444;
    text-align: center;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  }
  .group-table th {
    background: #222;
  }
  .group-table tr:nth-child(even) {
    background: #1e1e1e;
  }

  /* Knockout match container */
  .stage {
    margin-bottom: 40px;
  }
  .stage > h2 {
    color: #ff4d4d;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    font-weight: 700;
    margin-bottom: 15px;
  }
  .match {
    display: flex;
    flex-direction: column;
    align-items: center;
    border: 1px solid #555;
    border-radius: 8px;
    padding: 15px 20px;
    margin: 10px auto;
    max-width: 260px;
    background: #1a1a1a;
    color: #eee;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    box-shadow: 0 0 12px rgba(0,0,0,0.7);
  }

  .team {
    width: 100%;
    text-align: center;
    font-weight: 600;
    font-size: 1.15em;
    overflow-wrap: break-word;
    word-break: break-word;
    margin: 5px 0;
    white-space: normal;
  }

  .vs {
    font-weight: 700;
    margin: 6px 0;
    color: #ff4d4d;
    font-size: 1.2em;
  }

  .score {
    margin-top: 8px;
    font-size: 1.3em;
    font-weight: 700;
    color: #4caf50;
  }

  .countdown {
    margin-top: 6px;
    font-size: 0.9em;
    color: #aaa;
    font-family: monospace;
  }
</style>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
  import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-analytics.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
    authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
    databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
    projectId: "itzhoyoo-f9f7e",
    storageBucket: "itzhoyoo-f9f7e.firebasestorage.app",
    messagingSenderId: "1094792075584",
    appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5",
    measurementId: "G-LLT6F9WRKH"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const analytics = getAnalytics(app);

  const stageDiv = document.getElementById("tournament-stage");
  const GROUPS = ['A', 'B', 'C', 'D'];
  const TEAMS_PER_GROUP = 4;

  const countdownIntervals = new Map();

  function renderGroup(groupName, teams) {
    while (teams.length < TEAMS_PER_GROUP) {
      teams.push({ name: "TO BE ANNOUNCED", p: "-", w: "-", d: "-", l: "-", pts: "-" });
    }

    teams.sort((a, b) => (b.pts || 0) - (a.pts || 0));
    const groupEnded = teams.every(team => (team.p || 0) >= 5);

    let html = `<div style="display:flex; align-items:center; justify-content:space-between;">
      <h2>Group ${groupName}</h2>
      ${groupEnded ? '<span style="color:red; font-weight:bold;">ðŸ”´ GROUP ENDED</span>' : ''}
    </div>
    <div class="table-wrapper"><table class="group-table">
      <thead><tr>
        <th>Team</th><th>P</th><th>W</th><th>D</th><th>L</th><th>Pts</th>
      </tr></thead><tbody>`;

    teams.forEach((team, index) => {
      const highlight = index < 2 ? 'style="font-weight:bold;"' : '';
      html += `<tr ${highlight}>
        <td>${team.name}</td>
        <td>${team.p}</td>
        <td>${team.w}</td>
        <td>${team.d}</td>
        <td>${team.l}</td>
        <td>${team.pts}</td>
      </tr>`;
    });

    html += `</tbody></table></div>`;
    stageDiv.innerHTML += html;

    return { groupEnded, topTwo: teams.slice(0, 2) };
  }

  function createCountdownElement(id, targetTime) {
    const el = document.createElement('div');
    el.id = id;
    el.className = "countdown";
    el.style.marginTop = "8px";
    el.style.color = "#ccc";
    el.style.fontSize = "0.85em";

    function updateCountdown() {
      const now = Date.now();
      const diff = targetTime - now;
      if (diff <= 0) {
        el.textContent = "LIVE";
        clearInterval(countdownIntervals.get(id));
        countdownIntervals.delete(id);
        return;
      }
      const h = Math.floor(diff / 3600000);
      const m = Math.floor((diff % 3600000) / 60000);
      const s = Math.floor((diff % 60000) / 1000);
      el.textContent = `${h}h ${m}m ${s}s`;
    }

    updateCountdown();
    const interval = setInterval(updateCountdown, 1000);
    countdownIntervals.set(id, interval);

    return el;
  }

  function renderMatch(match, idx) {
    const team1 = match.team1 || "TBA";
    const team2 = match.team2 || "TBA";

    const container = document.createElement('div');
    container.className = 'match';

    const t1 = document.createElement('div');
    t1.className = 'team';
    t1.textContent = team1;
    container.appendChild(t1);

    const vs = document.createElement('div');
    vs.className = 'vs';
    vs.textContent = 'vs';
    container.appendChild(vs);

    const t2 = document.createElement('div');
    t2.className = 'team';
    t2.textContent = team2;
    container.appendChild(t2);

    // Score display, fallback 0:0
    const scoreDiv = document.createElement('div');
    scoreDiv.className = 'score';
    const score1 = (typeof match.score1 === 'number') ? match.score1 : 0;
    const score2 = (typeof match.score2 === 'number') ? match.score2 : 0;
    scoreDiv.textContent = `${score1} : ${score2}`;
    container.appendChild(scoreDiv);

    // Only show countdown if date exists in Firebase
    if (match.date) {
      const targetTime = new Date(match.date).getTime();
      const countdown = createCountdownElement(`countdown-${idx}`, targetTime);
      countdown.classList.add('countdown');
      container.appendChild(countdown);
    }

    return container;
  }

  function renderKnockout(stageName, matches) {
    const section = document.createElement('section');
    section.className = 'stage';

    const h2 = document.createElement('h2');
    h2.textContent = stageName;
    section.appendChild(h2);

    if (!matches.length) {
      section.appendChild(renderMatch({ team1: "TBA", team2: "TBA" }, 0));
    } else {
      matches.forEach((match, i) => {
        section.appendChild(renderMatch(match, i));
      });
    }

    stageDiv.appendChild(section);
  }

  async function loadTournament() {
    const dbRef = ref(db);
    try {
      const snapshot = await get(child(dbRef, 'tournament'));
      if (!snapshot.exists()) {
        stageDiv.innerHTML = "<p>No tournament data found.</p>";
        return;
      }

      const data = snapshot.val();
      const groupsData = data.groups || {};
      const qualifiedTeams = [];

      stageDiv.innerHTML = ""; // Clear existing content

      // Render groups and gather qualified teams (top 2)
      GROUPS.forEach(groupName => {
        const teamObj = groupsData[groupName] || {};
        const teams = Object.values(teamObj);
        const result = renderGroup(groupName, teams);
        qualifiedTeams.push(...result.topTwo);
      });

      // Get scores from knockout stage if exist
      const knockoutScores = data.knockout || {};

      // Quarter Finals
      let qf = [];
      if (qualifiedTeams.length >= 8) {
        qf = [
          {
            team1: qualifiedTeams[0]?.name,
            team2: qualifiedTeams[3]?.name,
            date: knockoutScores.qf?.match1?.date || "2025-06-21T18:00:00Z",
            score1: knockoutScores.qf?.match1?.score1 || 0,
            score2: knockoutScores.qf?.match1?.score2 || 0
          },
          {
            team1: qualifiedTeams[2]?.name,
            team2: qualifiedTeams[1]?.name,
            date: knockoutScores.qf?.match2?.date || "2025-06-22T18:00:00Z",
            score1: knockoutScores.qf?.match2?.score1 || 0,
            score2: knockoutScores.qf?.match2?.score2 || 0
          },
          {
            team1: qualifiedTeams[4]?.name,
            team2: qualifiedTeams[7]?.name,
            date: knockoutScores.qf?.match3?.date || "2025-06-23T18:00:00Z",
            score1: knockoutScores.qf?.match3?.score1 || 0,
            score2: knockoutScores.qf?.match3?.score2 || 0
          },
          {
            team1: qualifiedTeams[6]?.name,
            team2: qualifiedTeams[5]?.name,
            date: knockoutScores.qf?.match4?.date || "2025-06-24T18:00:00Z",
            score1: knockoutScores.qf?.match4?.score1 || 0,
            score2: knockoutScores.qf?.match4?.score2 || 0
          }
        ];
      } else {
        qf = [{ team1: "TBA", team2: "TBA", score1: 0, score2: 0 }];
      }
      renderKnockout("Quarter Finals", qf);

      // Semi Finals
      const sf = [
        {
          team1: knockoutScores.sf?.match1?.team1 || "TBA",
          team2: knockoutScores.sf?.match1?.team2 || "TBA",
          date: knockoutScores.sf?.match1?.date || "2025-06-26T18:00:00Z",
          score1: knockoutScores.sf?.match1?.score1 || 0,
          score2: knockoutScores.sf?.match1?.score2 || 0
        },
        {
          team1: knockoutScores.sf?.match2?.team1 || "TBA",
          team2: knockoutScores.sf?.match2?.team2 || "TBA",
          date: knockoutScores.sf?.match2?.date || "2025-06-27T18:00:00Z",
          score1: knockoutScores.sf?.match2?.score1 || 0,
          score2: knockoutScores.sf?.match2?.score2 || 0
        }
      ];
      renderKnockout("Semi Finals", sf);

      // Final
      const finalMatch = {
        team1: knockoutScores.final?.team1 || "TBA",
        team2: knockoutScores.final?.team2 || "TBA",
        date: knockoutScores.final?.date || "2025-06-30T20:00:00Z",
        score1: knockoutScores.final?.score1 || 0,
        score2: knockoutScores.final?.score2 || 0
      };
      renderKnockout("Final", [finalMatch]);

    } catch (e) {
      console.error(e);
      stageDiv.innerHTML = "<p>Error loading tournament data.</p>";
    }
  }

  loadTournament();
</script>
</body>
</html>