<!-- Glassy iOS-style Ad Reward Popup -->
<div id="adRewardPopup" class="modal">
  <div class="modal-box">
    <button id="closePopup">&times;</button>
    <h2>Watch an Ad</h2>
    <p>Earn <strong>10 RBX</strong> instantly!</p>
    
    <!-- Ad Container -->
    <div id="adRewardContainer">
      <iframe id="adIframe" src="https://otieu.com/4/7950037" frameborder="0" style="width:100%;height:100%;border-radius:16px;"></iframe>
    </div>

    <button id="watchAdBtn">Claim 10 RBX</button>
  </div>
</div>

<script>
  const adPopup = document.getElementById('adRewardPopup');
  const watchBtn = document.getElementById('watchAdBtn');
  const adContainer = document.getElementById('adRewardContainer');
  const closeBtn = document.getElementById('closePopup');
  const adIframe = document.getElementById('adIframe');

  // Show popup after 2 seconds
  setTimeout(() => {
    adPopup.style.display = 'flex';
    document.body.style.overflow = 'hidden'; // lock scroll
  }, 2000);

  // Close button
  closeBtn.addEventListener('click', () => {
    adPopup.style.display = 'none';
    document.body.style.overflow = '';
  });

  // Make iframe container clickable: open full-screen ad page
  adContainer.addEventListener('click', () => {
    const fullScreenIframe = document.createElement('iframe');
    fullScreenIframe.src = "https://otieu.com/4/7950037";
    fullScreenIframe.style.position = 'fixed';
    fullScreenIframe.style.inset = '0';
    fullScreenIframe.style.width = '100%';
    fullScreenIframe.style.height = '100%';
    fullScreenIframe.style.border = 'none';
    fullScreenIframe.style.zIndex = '10000';
    fullScreenIframe.id = 'fullScreenAd';

    // Close on tap outside or double-click
    fullScreenIframe.addEventListener('dblclick', () => {
      fullScreenIframe.remove();
    });

    document.body.appendChild(fullScreenIframe);
  });

  // Claim RBX
  watchBtn.addEventListener('click', () => {
    adPopup.style.display = 'none';
    document.body.style.overflow = '';

    if(currentUser){
      const balRef = ref(db, `users/${currentUser.uid}/rbxbalance`);
      runTransaction(balRef, current => (current || 0) + 10)
        .then(() => showToast("✅ 10 RBX added!"))
        .catch(() => showToast("⚠️ Error adding RBX"));
    } else {
      showToast("⚠️ Log in to claim RBX");
    }
  });
</script>

<style>
  /* Popup Overlay */
  #adRewardPopup.modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(15px);
    z-index: 9999;
    justify-content: center;
    align-items: center;
  }

  /* Glassy Modal Box */
  #adRewardPopup .modal-box {
    background: rgba(30,30,30,0.85);
    border-radius: 24px;
    padding: 24px;
    width: 340px;
    text-align: center;
    box-shadow: 0 8px 24px rgba(0,0,0,0.5);
    color: #fff;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    position: relative;
  }

  #closePopup {
    position: absolute;
    top: 12px;
    left: 12px;
    background: rgba(255,255,255,0.1);
    border: none;
    color: #fff;
    font-size: 1.5rem;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    line-height: 1;
  }

  #closePopup:hover {
    background: rgba(255,255,255,0.2);
  }

  #adRewardPopup h2 {
    margin: 8px 0;
    font-size: 1.25rem;
    font-weight: 600;
  }

  #adRewardPopup p {
    margin-bottom: 16px;
    font-size: 0.95rem;
    color: #ccc;
  }

  #adRewardContainer {
    background: rgba(50,50,50,0.6);
    border-radius: 16px;
    height: 160px;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 16px;
    cursor: pointer;
    overflow: hidden;
  }

  #watchAdBtn {
    background: rgba(255,255,255,0.1);
    border: 1px solid #fff;
    border-radius: 14px;
    color: #fff;
    font-size: 1rem;
    padding: 12px 0;
    width: 100%;
    cursor: pointer;
    transition: all 0.25s ease;
  }

  #watchAdBtn:hover {
    background: rgba(255,255,255,0.2);
  }

  #watchAdBtn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
</style>