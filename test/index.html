<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Support Chat</title>

<style>
#chat-bubble{
  position:fixed;bottom:20px;right:20px;
  width:58px;height:58px;
  background:#0084ff;color:#fff;
  font-size:26px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;z-index:9999;
  box-shadow:0 10px 25px rgba(0,0,0,.3);
}
#chat-box{
  position:fixed;bottom:90px;right:20px;
  width:320px;height:420px;
  background:#fff;border-radius:16px;
  box-shadow:0 15px 40px rgba(0,0,0,.35);
  display:none;flex-direction:column;
  overflow:hidden;z-index:9999;
  font-family:system-ui,-apple-system;
}
.chat-header{
  background:#0084ff;color:#fff;
  padding:12px;display:flex;
  justify-content:space-between;align-items:center;
}
.chat-header button{
  background:none;border:none;color:#fff;
  font-size:18px;cursor:pointer;
}
.chat-messages{
  flex:1;padding:12px;
  overflow-y:auto;background:#f2f2f2;
}
.msg{
  max-width:75%;padding:10px 14px;
  margin-bottom:8px;border-radius:18px;
  font-size:14px;
}
.msg.user{
  background:#0084ff;color:#fff;
  margin-left:auto;border-bottom-right-radius:4px;
}
.msg.admin{
  background:#e4e6eb;color:#000;
  margin-right:auto;border-bottom-left-radius:4px;
}
.chat-input{
  display:flex;padding:10px;background:#fff;
}
.chat-input input{
  flex:1;padding:8px;
  border-radius:20px;border:1px solid #ccc;
}
.chat-input button{
  margin-left:8px;background:#0084ff;
  border:none;color:#fff;
  padding:8px 14px;border-radius:20px;
  cursor:pointer;
}
.login-box{
  padding:16px;text-align:center;
}
.login-box input{
  width:100%;padding:8px;margin-bottom:8px;
}
</style>
</head>

<body>

<div id="chat-bubble" onclick="toggleChat()">ðŸ’¬</div>

<div id="chat-box">
  <div class="chat-header">
    <span>Support</span>
    <button onclick="toggleChat()">âœ•</button>
  </div>

  <div id="chatContent"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";
import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
  authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
  databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
  projectId: "itzhoyoo-f9f7e",
  storageBucket: "itzhoyoo-f9f7e.filestorage.app",
  messagingSenderId: "1094792075584",
  appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

const ADMIN = "watch4rbxadmin";
let currentUser, username;

window.toggleChat = () => {
  const box = document.getElementById("chat-box");
  box.style.display = box.style.display === "flex" ? "none" : "flex";
};

onAuthStateChanged(auth, user => {
  const content = document.getElementById("chatContent");

  if(!user){
    content.innerHTML = `
      <div class="login-box">
        <h4>Login to chat</h4>
        <input id="email" placeholder="Email">
        <input id="pass" type="password" placeholder="Password">
        <button onclick="login()">Login</button>
      </div>`;
    return;
  }

  currentUser = user.uid;
  username = "@" + user.email.split("@")[0];

  content.innerHTML = `
    <div class="chat-messages" id="messages"></div>
    <div class="chat-input">
      <input id="msgInput" placeholder="Messageâ€¦" 
        onkeydown="if(event.key==='Enter')sendMsg()">
      <button onclick="sendMsg()">Send</button>
    </div>`;

  const chatRef = ref(db, `supportChats/${ADMIN}/${currentUser}`);

  onChildAdded(chatRef, snap => {
    const m = snap.val();
    document.getElementById("messages").innerHTML +=
      `<div class="msg ${m.from === ADMIN ? 'admin' : 'user'}">
        <b>${m.name}</b><br>${m.text}
      </div>`;
  });
});

window.login = () => {
  signInWithEmailAndPassword(
    auth,
    document.getElementById("email").value,
    document.getElementById("pass").value
  );
};

window.sendMsg = () => {
  const input = document.getElementById("msgInput");
  if(!input.value) return;

  push(ref(db, `supportChats/${ADMIN}/${currentUser}`), {
    from: currentUser,
    name: username,
    text: input.value,
    time: Date.now()
  });

  input.value = "";
};
</script>

</body>
</html>