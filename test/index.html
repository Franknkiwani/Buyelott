<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>@JEKIBLOX</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","Helvetica Neue",sans-serif;}
body{background:url('https://static.vecteezy.com/system/resources/previews/002/142/935/large_2x/beautiful-tropical-beach-background-free-photo.jpg') no-repeat center/cover;display:flex;flex-direction:column;align-items:center;min-height:100vh;overflow-x:hidden;}

header{width:100%;padding:0.5rem 1rem;background:rgba(0,0,0,0.32);backdrop-filter:blur(10px);display:flex;align-items:center;gap:8px;position:sticky;top:0;z-index:10;}
header img{height:34px;width:34px;border-radius:8px;object-fit:cover;}
header span{color:white;font-size:1.15rem;font-weight:600;letter-spacing:0.4px;}

.auth-btn {
  margin-left:auto;
  padding:6px 14px;
  background:rgba(255,255,255,0.15);
  border:1px solid black;
  backdrop-filter:blur(12px);
  border-radius:12px;
  font-size:0.9rem;
  color:white;
  font-weight:600;
  cursor:pointer;
  transition:0.2s;
}
.auth-btn:hover { background:rgba(255,255,255,0.25); }

#userProfile{display:none;align-items:center;gap:6px;cursor:pointer;margin-left:auto;}
#userProfile img{width:32px;height:32px;border-radius:50%;object-fit:cover;}
#userProfile span{color:white;font-weight:600;}

.popup-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.5);backdrop-filter:blur(10px);display:none;justify-content:center;align-items:flex-start;padding-top:50px;overflow-y:auto;z-index:999;}
.popup{background:rgba(255,255,255,0.15);backdrop-filter:blur(15px);border-radius:20px;padding:2rem;width:90%;max-width:400px;display:flex;flex-direction:column;gap:1rem;color:black;position:relative;}
.popup h3{text-align:center;color:white;}
.popup .close-btn{position:absolute;top:10px;left:10px;background:rgba(0,0,0,0.7);border:none;color:white;padding:5px 10px;border-radius:12px;cursor:pointer;}
.popup input{width:100%;padding:0.6rem 0.8rem;border-radius:12px;border:none;outline:none;font-size:0.95rem;}
.popup button{padding:0.7rem;border:none;border-radius:12px;background:rgba(0,0,0,0.7);color:white;font-weight:600;cursor:pointer;transition:0.2s;}
.popup button:active{transform:scale(0.95);}
#profilePreview{width:80px;height:80px;border-radius:50%;object-fit:cover;display:block;margin:auto;}
.forgot-pass{color:white;text-decoration:underline;font-size:0.85rem;cursor:pointer;text-align:right;}

#switchModeBtn {
  background: rgba(0,0,0,0.6);
  color:white;
  border:1px solid rgba(255,255,255,0.3);
  backdrop-filter: blur(12px);
  border-radius:12px;
  padding:0.6rem;
  margin-top:5px;
  cursor:pointer;
}
#switchModeBtn:hover { background: rgba(0,0,0,0.8); }

.notification{position:fixed;top:20px;right:20px;padding:10px 18px;border-radius:12px;box-shadow:0 0 10px rgba(0,0,0,0.4);opacity:0;pointer-events:none;transition:opacity 0.4s, transform 0.4s;z-index:1000;}
.notification.show{opacity:1;transform:translateY(0);}
.notification.success{background:rgba(0,128,0,0.85);color:white;}
.notification.error{background:rgba(255,0,0,0.85);color:white;}
</style>
</head>
<body>

<header>
  <img src="https://i.imgur.com/96svPpA.jpeg" alt="logo">
  <span>@JEKIBLOX</span>
  <div id="authContainer" style="margin-left:auto;display:flex;align-items:center;gap:8px;">
    <button class="auth-btn" id="authBtn">REGISTER / LOGIN</button>
    <div id="userProfile">
      <img id="userPic" src="" alt="Profile">
      <span id="userName"></span>
    </div>
  </div>
</header>

<!-- Auth Popup -->
<div class="popup-overlay" id="authOverlay">
  <div class="popup">
    <button class="close-btn" id="closeAuthBtn">X</button>
    <h3 id="popupTitle">Register</h3>
    <img id="profilePreview" src="" alt="Profile Preview">
    <input type="file" id="profilePicInput" accept="image/*">
    <input type="text" id="usernameInput" placeholder="@username">
    <input type="email" id="emailInput" placeholder="Email">
    <input type="password" id="passwordInput" placeholder="Password">
    <span class="forgot-pass" id="forgotPass">Forgot Password?</span>
    <button id="authSubmitBtn">Register</button>
    <button id="switchModeBtn">Switch to Login</button>
  </div>
</div>

<!-- Logout confirmation popup -->
<div class="popup-overlay" id="logoutOverlay">
  <div class="popup" style="max-width:300px;text-align:center;">
    <h3>Log Out?</h3>
    <p>Do you really want to log out?</p>
    <div style="display:flex;gap:10px;justify-content:center;margin-top:10px;">
      <button id="cancelLogout" style="background:rgba(0,0,0,0.5);">Cancel</button>
      <button id="confirmLogout" style="background:rgba(255,0,0,0.85);">Yes</button>
    </div>
  </div>
</div>

<!-- Forgot password popup -->
<div class="popup-overlay" id="forgotOverlay">
  <div class="popup" style="max-width:300px;text-align:center;">
    <button class="close-btn" id="closeForgotBtn">X</button>
    <h3>Reset Password</h3>
    <input type="email" id="forgotEmailInput" placeholder="Enter your email">
    <button id="forgotSubmitBtn">Send Reset Email</button>
  </div>
</div>

<div id="notification" class="notification"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
  authDomain: "itzhoyoo.firebaseapp.com",
  databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
  projectId: "itzhoyoo-f9f7e",
  storageBucket: "itzhoyoo-filestorage.app",
  messagingSenderId: "1094792075584",
  appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5",
  measurementId: "G-LLT6F9WRKH"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

const authBtn = document.getElementById('authBtn');
const authOverlay = document.getElementById('authOverlay');
const closeAuthBtn = document.getElementById('closeAuthBtn');
const popupTitle = document.getElementById('popupTitle');
const switchModeBtn = document.getElementById('switchModeBtn');
const authSubmitBtn = document.getElementById('authSubmitBtn');
const profilePicInput = document.getElementById('profilePicInput');
const profilePreview = document.getElementById('profilePreview');
const usernameInput = document.getElementById('usernameInput');
const emailInput = document.getElementById('emailInput');
const passwordInput = document.getElementById('passwordInput');
const forgotPass = document.getElementById('forgotPass');
const userProfile = document.getElementById('userProfile');
const userPic = document.getElementById('userPic');
const userName = document.getElementById('userName');
const logoutOverlay = document.getElementById('logoutOverlay');
const cancelLogout = document.getElementById('cancelLogout');
const confirmLogout = document.getElementById('confirmLogout');
const forgotOverlay = document.getElementById('forgotOverlay');
const closeForgotBtn = document.getElementById('closeForgotBtn');
const forgotEmailInput = document.getElementById('forgotEmailInput');
const forgotSubmitBtn = document.getElementById('forgotSubmitBtn');

let isRegisterMode = true;
let profilePicFile = null;
let notifTimeout;

function showNotification(msg,type='success'){
  const notification = document.getElementById('notification');
  notification.textContent = msg;
  notification.className='notification show '+(type==='success'?'success':'error');
  clearTimeout(notifTimeout);
  notifTimeout = setTimeout(()=>notification.className='notification',3000);
}

// Open/close auth popup
authBtn.addEventListener('click',()=> authOverlay.style.display='flex');
closeAuthBtn.addEventListener('click',()=> authOverlay.style.display='none');

// Switch mode
switchModeBtn.addEventListener('click',()=>{
  isRegisterMode=!isRegisterMode;
  usernameInput.style.display = isRegisterMode ? 'block' : 'none';
  profilePicInput.style.display = isRegisterMode ? 'block' : 'none';
  profilePreview.style.display = isRegisterMode ? 'block' : 'none';
  popupTitle.textContent = isRegisterMode ? "Register" : "Login";
  authSubmitBtn.textContent = isRegisterMode ? "Register" : "Login";
  switchModeBtn.textContent = isRegisterMode ? "Switch to Login" : "Switch to Register";
  emailInput.value=''; passwordInput.value=''; usernameInput.value=''; profilePicInput.value=''; profilePreview.src='';
});

// Profile pic preview
profilePicInput.addEventListener('change',()=>{
  const file = profilePicInput.files[0];
  if(file){
    profilePicFile = file;
    const reader = new FileReader();
    reader.onload = e=>profilePreview.src=e.target.result;
    reader.readAsDataURL(file);
  } else {
    profilePreview.src='';
    profilePicFile=null;
  }
});

// Register/Login submit
authSubmitBtn.addEventListener('click', async ()=>{
  const email = emailInput.value.trim();
  const password = passwordInput.value.trim();
  const username = usernameInput.value.trim();

  if(!email || !password) return showNotification("Email & password required!",'error');
  if(isRegisterMode && !username) return showNotification("@username required!",'error');

  try{
    let user, userData={};

    if(isRegisterMode){
      const cred = await createUserWithEmailAndPassword(auth,email,password);
      user = cred.user;

      let profileUrl="";
      if(profilePicFile){
        const formData=new FormData();
        formData.append('image',profilePicFile);
        const res = await fetch('https://api.imgur.com/3/image',{
          method:'POST',
          headers:{Authorization:'Client-ID 891e5bb4aa94282'},
          body:formData
        });
        const data = await res.json();
        if(data.success) profileUrl=data.data.link;
      }

      userData = { username, email, profilePic: profileUrl };
      await set(ref(db,'jekiblox/users/'+user.uid),userData);
      showNotification("Registration successful!","success");

    } else {
      const cred = await signInWithEmailAndPassword(auth,email,password);
      user = cred.user;

      const dbRef = ref(db,'jekiblox/users/'+user.uid);
      const snapshot = await new Promise(res=>onValue(dbRef,snap=>res(snap),{onlyOnce:true}));
      userData = snapshot.val();
      showNotification("Login successful!","success");
    }

    // Reset inputs and close popup
    authOverlay.style.display='none';
    profilePicInput.value=''; profilePreview.src='';
    emailInput.value=''; passwordInput.value=''; usernameInput.value='';

    // **Update header immediately**
    if(userData){
      authBtn.style.display='none';
      userProfile.style.display='flex';
      userPic.src = userData.profilePic || 'https://i.imgur.com/96svPpA.jpeg';
      userName.textContent = userData.username || user.email.split('@')[0];
    }

  } catch(e){ showNotification(e.message,'error'); }
});

// Forgot password popup
forgotPass.addEventListener('click',()=> forgotOverlay.style.display='flex');
closeForgotBtn.addEventListener('click',()=> forgotOverlay.style.display='none');
forgotSubmitBtn.addEventListener('click',async()=>{
  const email = forgotEmailInput.value.trim();
  if(!email) return showNotification("Enter your email!",'error');
  try{
    await sendPasswordResetEmail(auth,email);
    forgotOverlay.style.display='none';
    showNotification("Password reset email sent!","success");
  } catch(e){ showNotification(e.message,'error'); }
});

// Update header after checking user data exists
authBtn.style.display='none';
userProfile.style.display='none';
onAuthStateChanged(auth, async user=>{
  if(user){
    const dbRef = ref(db,'jekiblox/users/'+user.uid);
    const snapshot = await new Promise(res=>onValue(dbRef,snap=>res(snap),{onlyOnce:true}));
    const userData = snapshot.val();
    if(userData){
      authBtn.style.display='none';
      userProfile.style.display='flex';
      userPic.src = userData?.profilePic || 'https://i.imgur.com/96svPpA.jpeg';
      userName.textContent = userData?.username || user.email.split('@')[0];
    } else authBtn.style.display='block';
  } else authBtn.style.display='block';
});

// Logout
userProfile.addEventListener('click',()=>logoutOverlay.style.display='flex');
cancelLogout.addEventListener('click',()=>logoutOverlay.style.display='none');
confirmLogout.addEventListener('click',async()=>{
  await auth.signOut();
  logoutOverlay.style.display='none';
  authBtn.style.display='block';
  userProfile.style.display='none';
  showNotification("Logged out","success");
});
</script>
</body>
</html>