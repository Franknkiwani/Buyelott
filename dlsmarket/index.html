<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DLSMARKET | Premium Marketplace</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
<style>
    body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #050505; color: #ffffff; scroll-behavior: smooth; }
    .glass-nav { background: rgba(10,10,10,0.75); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255,255,255,0.05); }
    .sidebar { transition: transform 0.4s cubic-bezier(0.4,0,0.2,1); background: #0a0a0a; border-left: 1px solid rgba(255,255,255,0.1); }
    .glass-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); backdrop-filter: blur(12px); transition: all 0.4s ease; }
    .glass-card:hover { transform: translateY(-5px); border-color: rgba(255,255,255,0.2); box-shadow: 0 10px 30px rgba(255,255,255,0.05); }
    .hero-overlay { background: linear-gradient(to right, #050505 20%, rgba(5,5,5,0.4) 60%, transparent 100%); }
    .bottom-fade { background: linear-gradient(to top, #050505 0%, transparent 100%); }
    .no-scroll { overflow: hidden !important; height: 100vh; }
    input::placeholder { color: rgba(255,255,255,0.3); }
    .tier-badge { font-size: 9px; font-weight: 900; letter-spacing: 1px; padding: 4px 12px; border-radius: 99px; text-transform: uppercase; }
</style>
</head>
<body>

<header class="fixed top-0 w-full z-50 glass-nav">
    <div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
        <div class="flex items-center gap-3 cursor-pointer" onclick="window.location.reload()">
            <img src="https://png.pngtree.com/png-vector/20250205/ourlarge/pngtree-black-and-white-football-logo-png-image_15382257.png" class="w-9 h-9 bg-white rounded-full p-0.5" alt="Logo">
            <span class="font-extrabold tracking-tighter text-xl uppercase">DLSMARKET</span>
        </div>
        <div class="flex items-center gap-6">
            <div id="auth-ui">
                <button id="login-btn" onclick="openAuthModal()" class="px-5 py-2 bg-white text-black text-sm font-bold rounded-full hover:bg-gray-200 transition">Login</button>
                <div id="user-profile" class="hidden flex items-center gap-3 cursor-pointer group" onclick="toggleSidebar()">
                    <div class="text-right hidden sm:block">
                        <p id="user-name" class="text-xs font-bold group-hover:text-blue-400 transition"></p>
                        <p class="text-[10px] text-gray-500 uppercase tracking-widest">Premium Member</p>
                    </div>
                    <img id="user-photo" src="" class="w-10 h-10 rounded-full border-2 border-white/10" alt="User">
                </div>
            </div>
        </div>
    </div>
</header>

<aside id="sidebar" class="sidebar fixed top-0 right-0 h-full w-80 z-[60] translate-x-full p-8 shadow-2xl">
    <div class="flex justify-between items-center mb-12">
        <h2 class="text-2xl font-black uppercase italic text-white">Dashboard</h2>
        <button onclick="toggleSidebar()" class="w-10 h-10 flex items-center justify-center rounded-full bg-white/5 hover:bg-white/10">✕</button>
    </div>
    <nav class="space-y-3">
        <a href="#" class="block p-4 rounded-2xl glass-card hover:bg-white/10 transition">My Inventory</a>
        <button id="logout-btn" class="w-full text-left p-4 rounded-2xl bg-red-500/5 text-red-500 font-bold hover:bg-red-500/10 transition mt-20">Sign Out</button>
    </nav>
</aside>

<div id="login-modal" class="fixed inset-0 z-[100] hidden items-center justify-center px-4">
    <div class="absolute inset-0 bg-black/90 backdrop-blur-md" onclick="closeModal()"></div>
    <div class="relative glass-card p-8 rounded-[40px] max-w-sm w-full border-white/20">
        <h3 id="modal-title" class="text-3xl font-black uppercase italic mb-6 text-center">Login</h3>
        <div class="space-y-4 mb-6">
            <input type="text" id="auth-displayname" placeholder="Full Name" class="hidden w-full bg-white/5 border border-white/10 rounded-2xl px-5 py-3 outline-none focus:border-blue-500 transition">
            <input type="email" id="auth-email" placeholder="Email Address" class="w-full bg-white/5 border border-white/10 rounded-2xl px-5 py-3 outline-none focus:border-blue-500 transition">
            <input type="password" id="auth-password" placeholder="Password" class="w-full bg-white/5 border border-white/10 rounded-2xl px-5 py-3 outline-none focus:border-blue-500 transition">
            <button onclick="handleEmailAuth()" id="main-auth-btn" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black uppercase tracking-widest hover:bg-blue-700 transition">Login</button>
        </div>
        <button onclick="triggerGoogleLogin()" class="w-full bg-white text-black py-3 rounded-2xl font-bold uppercase text-xs flex items-center justify-center gap-2 hover:bg-gray-200 transition mb-4">
            <img src="https://www.google.com/favicon.ico" class="w-4 h-4"> Continue with Google
        </button>
        <div class="flex justify-between px-2">
            <button onclick="toggleAuthMode()" id="toggle-mode-btn" class="text-blue-400 text-[10px] font-bold uppercase tracking-widest">Create Account</button>
            <button onclick="handleForgotPassword()" class="text-gray-500 text-[10px] font-bold uppercase tracking-widest">Forgot Password?</button>
        </div>
    </div>
</div>

<section class="relative min-h-screen w-full flex items-center overflow-hidden">
    <div class="absolute inset-0 z-0">
        <img src="https://i.ytimg.com/vi/Zloqus-F6Bw/hq720.jpg" class="w-full h-full object-cover brightness-[0.4]" alt="Hero Background">
        <div class="absolute inset-0 hero-overlay"></div>
        <div class="absolute inset-0 bottom-fade"></div>
    </div>
    <div class="relative z-10 max-w-7xl mx-auto px-6 w-full pt-20">
        <div class="max-w-3xl">
            <h1 class="text-6xl lg:text-8xl font-black leading-[0.95] tracking-tighter mb-8 italic uppercase">
                Build your <br><span class="text-transparent bg-clip-text bg-gradient-to-r from-white to-gray-500">Legendary</span> <br>Squad.
            </h1>
            <p class="text-gray-300 text-lg md:text-xl max-w-lg leading-relaxed mb-12 opacity-80">
                Trade high-tier DLS accounts with verified owners. Secure escrow, instant delivery, and 24/7 support.
            </p>
            <div class="flex flex-col sm:flex-row gap-5">
                <button onclick="scrollToAccounts()" class="bg-white text-black px-10 py-5 rounded-2xl font-black text-sm uppercase tracking-widest hover:scale-105 transition">Browse Accounts</button>
                <button onclick="handleSaleClick()" class="bg-white/5 backdrop-blur-xl border border-white/10 text-white px-10 py-5 rounded-2xl font-black text-sm uppercase tracking-widest hover:bg-white/10 transition">Sale Account</button>
            </div>
        </div>
    </div>
</section>

<main id="listings-section" class="max-w-7xl mx-auto px-6 py-24">
    <div class="flex flex-col md:flex-row md:items-end justify-between gap-8 mb-12">
        <div>
            <h2 class="text-4xl font-black uppercase italic tracking-tighter">Marketplace</h2>
            <div class="h-1.5 w-20 bg-blue-600 mt-2 mb-6"></div>
            <div class="flex flex-wrap gap-3" id="filter-bar">
                <button onclick="filterAccounts('all')" class="filter-btn active px-6 py-2 rounded-full border border-white/10 text-[10px] font-black uppercase tracking-widest bg-white text-black transition">All</button>
                <button onclick="filterAccounts('Legendary')" class="filter-btn px-6 py-2 rounded-full border border-white/10 text-[10px] font-black uppercase tracking-widest hover:bg-white/5 transition">Legendary</button>
                <button onclick="filterAccounts('Average')" class="filter-btn px-6 py-2 rounded-full border border-white/10 text-[10px] font-black uppercase tracking-widest hover:bg-white/5 transition">Average</button>
            </div>
        </div>
    </div>
    <div id="accounts-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
        <div class="animate-pulse glass-card h-80 rounded-[32px]"></div>
        <div class="animate-pulse glass-card h-80 rounded-[32px]"></div>
        <div class="animate-pulse glass-card h-80 rounded-[32px]"></div>
    </div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
import { 
    getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut,
    createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail, updateProfile 
} from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

// --- CONFIGURATION ---
const firebaseConfig = {
    apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
    authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
    databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
    projectId: "itzhoyoo-f9f7e",
    storageBucket: "itzhoyoo-filestorage.app",
    messagingSenderId: "1094792075584",
    appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);
const provider = new GoogleAuthProvider();

// --- STATE MANAGEMENT ---
let allAccounts = [];
let currentFilter = 'all';
let currentUser = null;
let isRegisterMode = false;

// --- UI HELPERS ---
const toggleScroll = (isLocked) => {
    document.body.classList.toggle('no-scroll', isLocked);
};

window.openAuthModal = () => {
    document.getElementById('login-modal').classList.replace('hidden', 'flex');
    toggleScroll(true);
};

window.closeModal = () => {
    document.getElementById('login-modal').classList.replace('flex', 'hidden');
    const checkout = document.querySelector('.checkout-modal');
    if(checkout) checkout.remove();
    toggleScroll(false);
};

window.toggleAuthMode = () => {
    isRegisterMode = !isRegisterMode;
    document.getElementById('modal-title').textContent = isRegisterMode ? 'Register' : 'Login';
    document.getElementById('main-auth-btn').textContent = isRegisterMode ? 'Sign Up' : 'Login';
    document.getElementById('toggle-mode-btn').textContent = isRegisterMode ? 'Already have an account?' : 'Create Account';
    document.getElementById('auth-displayname').classList.toggle('hidden', !isRegisterMode);
};

// --- AUTH HANDLERS ---
window.triggerGoogleLogin = () => { 
    signInWithPopup(auth, provider).then(closeModal).catch(e => alert(e.message)); 
};

window.handleEmailAuth = async () => {
    const email = document.getElementById('auth-email').value;
    const password = document.getElementById('auth-password').value;
    const displayName = document.getElementById('auth-displayname').value;

    if(!email || !password) return alert("Please fill in email and password.");

    try {
        if (isRegisterMode) {
            if(!displayName) return alert("Please enter your name.");
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            await updateProfile(userCredential.user, { displayName: displayName });
        } else {
            await signInWithEmailAndPassword(auth, email, password);
        }
        closeModal();
    } catch (error) {
        alert(error.message);
    }
};

window.handleForgotPassword = async () => {
    const email = document.getElementById('auth-email').value;
    if(!email) return alert("Enter your email address first.");
    try {
        await sendPasswordResetEmail(auth, email);
        alert("Password reset email sent!");
    } catch (error) {
        alert(error.message);
    }
};

// --- DATA LOGIC ---
const shuffle = (array) => {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
};

window.filterAccounts = (tier) => {
    currentFilter = tier;
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.toggle('bg-white', false);
        btn.classList.toggle('text-black', false);
    });
    event.target.classList.add('bg-white', 'text-black');
    renderListings();
};

const renderListings = () => {
    const list = document.getElementById('accounts-list');
    list.innerHTML = '';
    
    const filtered = currentFilter === 'all' 
        ? allAccounts 
        : allAccounts.filter(acc => acc.tier === currentFilter);

    if(filtered.length === 0) {
        list.innerHTML = '<p class="text-gray-500 col-span-full py-20 text-center uppercase font-black text-xs tracking-widest">No matching accounts found.</p>';
        return;
    }

    filtered.forEach(account => {
        const card = document.createElement('div');
        // REFINED DESIGN: Added transition-transform and hover:shadow-glow
        card.className = 'glass-card p-3 rounded-[32px] group flex flex-col transition-all duration-500 hover:-translate-y-2 hover:shadow-[0_20px_40px_rgba(0,0,0,0.4)] border border-white/5 hover:border-white/20';
        
        const mainImage = (account.images && account.images[0]) || account.image || 'https://via.placeholder.com/400x200?text=No+Image';
        const tierColor = account.tier === 'Legendary' ? 'text-yellow-400 bg-yellow-400/10' : 'text-blue-400 bg-blue-400/10';

        card.innerHTML = `
            <div class="relative h-52 w-full rounded-[26px] overflow-hidden mb-5">
                <img src="${mainImage}" class="w-full h-full object-cover group-hover:scale-105 transition duration-[1.5s] ease-out">
                <div class="absolute top-3 right-3 px-3 py-1.5 bg-black/40 backdrop-blur-xl rounded-full text-[10px] font-black uppercase tracking-tighter border border-white/10 ${tierColor}">
                    ● ${account.tier || 'Verified'}
                </div>
            </div>
            <div class="px-2 pb-2 flex flex-col flex-grow">
                <h3 class="text-xl font-black uppercase italic tracking-tight leading-none mb-1">${account.name || 'Unnamed Account'}</h3>
                <p class="text-white/40 text-[9px] font-bold uppercase tracking-[0.2em]">Listed by @${(account.owner||'User').split('@')[0]}</p>
                
                <div class="flex items-center justify-between mt-8">
                    <div>
                        <p class="text-[9px] text-white/30 uppercase font-black mb-0.5">Instant Access</p>
                        <p class="text-2xl font-black leading-none">$${account.price || '0'}</p>
                    </div>
                    <button onclick="openCheckoutModal('${account.id}')" class="bg-white text-black h-12 px-6 rounded-2xl font-black uppercase text-[10px] tracking-widest hover:bg-blue-600 hover:text-white transition-colors duration-300">
                        Buy Now
                    </button>
                </div>
            </div>
        `;
        list.appendChild(card);
    });
};

// --- CHECKOUT SYSTEM ---
window.openCheckoutModal = (id) => {
    if(!currentUser) return openAuthModal();
    const acc = allAccounts.find(a => a.id === id);
    const phoneNum = "+27846737224";
    const paypalLink = `https://paypal.me/farainkiwani456/${acc.price}?locale.x=en_US&country.x=ZA`;

    toggleScroll(true);
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 z-[200] flex items-center justify-center bg-black/95 backdrop-blur-xl checkout-modal p-4';
    
    // IMAGE SWAP: PayPal now uses the colored logo, MiniPay uses the white vector
    modal.innerHTML = `
        <div class="glass-card max-w-lg w-full p-10 rounded-[40px] border-white/20 shadow-2xl relative">
            <button onclick="closeModal()" class="absolute top-8 right-8 text-gray-400 hover:text-white font-black text-xl transition-transform hover:rotate-90">✕</button>
            
            <p class="text-blue-500 text-[10px] font-black uppercase tracking-[0.3em] mb-4 text-center">Secure Checkout</p>
            <h2 class="text-3xl font-black italic uppercase mb-8 text-center leading-tight">${acc.name}</h2>
            
            <div class="bg-blue-600/10 border border-blue-500/20 p-4 rounded-2xl mb-8">
                <p class="text-[10px] text-blue-400 font-black uppercase tracking-wider text-center">
                    ⚠️ IMPORTANT: To avoid 21-day holds, select <span class="text-white">"Sending to a friend"</span> on PayPal.
                </p>
            </div>

            <div class="space-y-4">
                <div class="bg-white/5 rounded-2xl border border-white/10 p-5 hover:border-blue-500 transition">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-4">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQmluVNSCSWBfRqjQUbqW9adqkrKVsVwitC29gUpz1PZQ&s=10" class="w-8 rounded-lg" alt="PayPal">
                            <span class="text-xs font-bold uppercase tracking-widest">PayPal (Personal)</span>
                        </div>
                        <a href="${paypalLink}" target="_blank" class="bg-blue-600 text-white text-[10px] font-black px-5 py-2.5 rounded-xl uppercase hover:bg-blue-500 transition">Pay $${acc.price}</a>
                    </div>
                    <p class="text-[9px] text-gray-500 uppercase font-bold">Funds clear instantly with Friends & Family.</p>
                </div>

                <div class="bg-white/5 rounded-2xl border border-white/10 p-5 hover:border-green-500 transition">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-4">
                            <img src="https://cdn.prod.website-files.com/67a18fbe6a1b30b8c753f370/67d24d44921ae7e4d272fbf2_Layout%20Modification.svg" class="w-8" alt="MiniPay">
                            <span class="text-xs font-bold uppercase tracking-widest">Mini Pay</span>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="copyNum('${phoneNum}', this)" class="text-[9px] font-black bg-white/10 px-3 py-2 rounded-lg uppercase hover:bg-white hover:text-black transition">Copy</button>
                            <a href="https://minipay.to/" target="_blank" class="text-[9px] font-black bg-green-600/20 text-green-500 px-3 py-2 rounded-lg uppercase hover:bg-green-600 hover:text-white transition">Open App</a>
                        </div>
                    </div>
                    <div class="p-4 bg-black/40 rounded-xl mb-4 text-center border border-white/5">
                        <p class="text-[10px] text-gray-400 uppercase font-bold mb-1">Send to Number:</p>
                        <a href="tel:${phoneNum}" class="text-xl font-black text-white hover:text-green-500 transition">${phoneNum}</a>
                    </div>
                    <p class="text-[10px] text-gray-500 uppercase leading-relaxed font-bold">
                        1. Send <span class="text-white">$${acc.price}</span> manually.<br>
                        2. Send screenshot to <a href="/support" class="text-blue-400 underline">Support Team</a>.
                    </p>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
};

window.copyNum = (num, btn) => {
    navigator.clipboard.writeText(num).then(() => {
        const oldText = btn.textContent;
        btn.textContent = "COPIED!";
        btn.classList.add('bg-green-500', 'text-black');
        setTimeout(() => {
            btn.textContent = oldText;
            btn.classList.remove('bg-green-500', 'text-black');
        }, 2000);
    });
};

// --- INITIALIZATION & OBSERVERS ---
onAuthStateChanged(auth, user => {
    currentUser = user;
    const loginBtn = document.getElementById('login-btn');
    const userProfile = document.getElementById('user-profile');
    if (user) {
        loginBtn.classList.add('hidden');
        userProfile.classList.remove('hidden');
        document.getElementById('user-name').textContent = user.displayName || user.email.split('@')[0];
        document.getElementById('user-photo').src = user.photoURL || `https://ui-avatars.com/api/?name=${user.email}&background=random`;
    } else {
        loginBtn.classList.remove('hidden');
        userProfile.classList.add('hidden');
    }
});

onValue(ref(db, 'dls_accounts'), (snapshot) => {
    if (snapshot.exists()) {
        const data = snapshot.val();
        allAccounts = shuffle(Object.entries(data).map(([id, val]) => ({ id, ...val })));
        renderListings();
    }
});

// --- GLOBAL ACTIONS ---
window.handleSaleClick = () => auth.currentUser ? window.location.href='/saleaccounts' : openAuthModal();
window.scrollToAccounts = () => document.getElementById('listings-section').scrollIntoView({behavior:'smooth'});
window.toggleSidebar = () => document.getElementById('sidebar').classList.toggle('translate-x-full');
document.getElementById('logout-btn').onclick = () => signOut(auth);

</script>

</body>
</html>
