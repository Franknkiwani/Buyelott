<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dating Hub Dark Stats Dashboard</title>

<link rel="icon" href="https://cdn-icons-png.flaticon.com/512/833/833472.png" type="image/png">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
/* Disable text selection & highlight */
* {
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  -webkit-tap-highlight-color: transparent;
}
body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  background: #121212;
  color: #eee;
  padding: 20px;
}
h1 {
  text-align: center;
  color: #ff4d6d;
  margin-bottom: 30px;
}
.controls {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-bottom: 30px;
  flex-wrap: wrap;
}
.controls input[type="date"] {
  padding: 8px 12px;
  border-radius: 8px;
  border: none;
  outline: none;
  font-size: 1rem;
}
.refresh-btn {
  background: #28a745;
  border: none;
  padding: 8px 12px;
  border-radius: 8px;
  cursor: pointer;
  display: flex;
  align-items: center;
  color: #fff;
  font-weight: bold;
  gap: 5px;
  transition: background 0.3s;
}
.refresh-btn:hover {
  background: #218838;
}
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
  max-width: 1000px;
  margin: auto;
}
.stat-card {
  background: #1e1e1e;
  padding: 25px 20px;
  border-radius: 15px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.5);
  text-align: center;
  transition: transform 0.2s, box-shadow 0.2s;
}
.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 12px 25px rgba(0,0,0,0.7);
}
.stat-card h2 {
  font-size: 1.4rem;
  margin-bottom: 10px;
  color: #ff4d6d;
}
.stat-card p {
  font-size: 1.3rem;
  font-weight: 600;
  margin: 0;
  color: #fff;
}
.refresh-icon {
  width: 18px;
  height: 18px;
  animation: spin 1s linear infinite;
}
@keyframes spin {
  0% { transform: rotate(0deg);}
  100% { transform: rotate(360deg);}
}
</style>
</head>
<body>

<h1>Dating Hub Dark Stats Dashboard</h1>

<div class="controls">
  <label>From: <input type="date" id="startDate"></label>
  <label>To: <input type="date" id="endDate"></label>
  <button class="refresh-btn" id="refreshBtn">
    <svg class="refresh-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#fff">
      <path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6a6 6 0 01-6 6 6 6 0 01-6-6h-2a8 8 0 008 8 8 8 0 008-8c0-4.42-3.58-8-8-8z"/>
    </svg>
    Refresh
  </button>
</div>

<div class="stats-grid">
  <div class="stat-card">
    <h2>Total Visits</h2>
    <p id="totalVisits">0</p>
  </div>
  <div class="stat-card">
    <h2>Successful Visits</h2>
    <p id="successVisits">0</p>
  </div>
  <div class="stat-card">
    <h2>Unsuccessful Visits</h2>
    <p id="unsuccessVisits">0</p>
  </div>
  <div class="stat-card">
    <h2>Total Clicks</h2>
    <p id="totalClicks">0</p>
  </div>
  <div class="stat-card">
    <h2>Click-Through Rate (CTR)</h2>
    <p id="ctr">0%</p>
  </div>
  <div class="stat-card">
    <h2>Profit ($2.40/email)</h2>
    <p id="profit">$0</p>
  </div>
</div>

<script>
// ---------------- Firebase Config ----------------
const firebaseConfig = {
  apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
  authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
  databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
  projectId: "itzhoyoo-f9f7e",
  storageBucket: "itzhoyoo-f9f7e.filestorage.app",
  messagingSenderId: "1094792075584",
  appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5",
  measurementId: "G-LLT6F9WRKH"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const visitsRef = db.ref('datingstats/visits');
const clicksRef = db.ref('datingstats/clicks');

// ---------------- Elements ----------------
const totalVisitsEl = document.getElementById('totalVisits');
const successVisitsEl = document.getElementById('successVisits');
const unsuccessVisitsEl = document.getElementById('unsuccessVisits');
const totalClicksEl = document.getElementById('totalClicks');
const ctrEl = document.getElementById('ctr');
const profitEl = document.getElementById('profit');

const startDateEl = document.getElementById('startDate');
const endDateEl = document.getElementById('endDate');
const refreshBtn = document.getElementById('refreshBtn');

// Allowed countries
const allowedCountries = ["United States","United Kingdom","Canada","Australia","South Africa","Ireland"];
const offerPayout = 2.4;

// ---------------- Helper ----------------
function filterByDate(data, start, end) {
  return data.filter(d => {
    const ts = d.timestamp;
    return (!start || ts >= start) && (!end || ts <= end);
  });
}

function updateStats(visits, clicks) {
  const totalVisits = visits.length;
  const successVisits = visits.filter(v => v.type === "success").length;
  const unsuccessVisits = visits.filter(v => v.type === "unsuccessful").length;
  const totalClicks = clicks.length;
  const ctr = totalVisits > 0 ? ((totalClicks / totalVisits) * 100).toFixed(2) : 0;
  const profit = successVisits * offerPayout;

  totalVisitsEl.textContent = totalVisits;
  successVisitsEl.textContent = successVisits;
  unsuccessVisitsEl.textContent = unsuccessVisits;
  totalClicksEl.textContent = totalClicks;
  ctrEl.textContent = ctr + "%";
  profitEl.textContent = "$" + profit.toFixed(2);
}

// ---------------- Load Data ----------------
function loadData() {
  const start = startDateEl.value ? new Date(startDateEl.value).getTime() : null;
  const end = endDateEl.value ? new Date(endDateEl.value).getTime() + 86400000 : null; // include end day

  visitsRef.once('value').then(visSnap => {
    clicksRef.once('value').then(clickSnap => {
      const visits = visSnap.exists() ? filterByDate(Object.values(visSnap.val()), start, end) : [];
      const clicks = clickSnap.exists() ? filterByDate(Object.values(clickSnap.val()), start, end) : [];
      updateStats(visits, clicks);
    });
  });
}

// Initial load
loadData();

// Refresh button
refreshBtn.addEventListener("click", loadData);
</script