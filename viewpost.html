<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>View Post</title>
  <style>
    :root {
      --bg: #ffffff;
      --fg: #111111;
      --muted: #666;
      --card: #f9f9f9;
      --shadow: rgba(0, 0, 0, 0.05);
      --primary: #007aff;
      --ios-blue: #007aff;
      --ios-bg: #f2f2f7;
    }
    [data-theme="dark"] {
      --bg: #121212;
      --fg: #ffffff;
      --muted: #aaa;
      --card: #1e1e1e;
      --shadow: rgba(0, 0, 0, 0.4);
      --ios-bg: #2c2c2e;
    }

    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      transition: background 0.3s, color 0.3s;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    header {
      position: sticky;
      top: 0;
      background: var(--bg);
      padding: 1rem 1.5rem;
      font-weight: bold;
      font-size: 1.5rem;
      border-bottom: 1px solid var(--muted);
      box-shadow: 0 2px 8px var(--shadow);
      z-index: 10;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .theme-toggle {
      cursor: pointer;
      font-size: 0.9rem;
      color: var(--muted);
      border: none;
      background: none;
    }

    main {
      max-width: 720px;
      margin: 2rem auto 4rem;
      padding: 0 1rem;
    }

    #status {
      color: red;
      font-weight: bold;
      margin-bottom: 1rem;
      display: none;
      text-align: center;
    }

    /* Post styling */
    .post-image {
      width: 100%;
      max-height: 480px;
      object-fit: contain;
      border-radius: 12px;
      box-shadow: 0 6px 16px var(--shadow);
      margin-bottom: 1rem;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    h1.post-title {
      font-size: 2rem;
      margin: 0 0 0.5rem;
      text-align: center;
      font-weight: 700;
      user-select: none;
    }

    .post-description {
      font-size: 1rem;
      line-height: 1.6;
      color: var(--fg);
      max-width: 650px;
      margin: 0 auto 1rem;
      text-align: center;
      white-space: pre-wrap;
      user-select: text;
    }
    .read-more {
      display: block;
      text-align: center;
      color: var(--ios-blue);
      cursor: pointer;
      font-weight: 600;
      margin-bottom: 1rem;
      user-select: none;
    }
    .read-more:hover {
      text-decoration: underline;
    }

    /* Post info area (profile pic, username, views, follow button) */
    .post-info {
      display: flex;
      align-items: center;
      font-size: 0.9rem;
      color: var(--muted);
      margin-bottom: 2rem;
      gap: 1rem;
      justify-content: center;
    }
    .profile-pic {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      object-fit: cover;
      background: #ccc;
      flex-shrink: 0;
      user-select: none;
    }

    .username {
      font-weight: 600;
      user-select: text;
    }

    .views {
      color: var(--muted);
      user-select: none;
    }

    .follow-button {
      padding: 0.4rem 1rem;
      border: none;
      border-radius: 16px;
      background: var(--primary);
      color: #fff;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      transition: background-color 0.3s;
      user-select: none;
      min-width: 90px;
    }
    .follow-button:disabled {
      background: var(--muted);
      cursor: not-allowed;
    }
    .follow-button:hover:not(:disabled) {
      background: #005bb5;
    }

    /* Modal styles */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      backdrop-filter: blur(5px);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal {
      background: var(--ios-bg);
      padding: 1.5rem 2rem;
      border-radius: 20px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      color: var(--fg);
      user-select: none;
      text-align: center;
    }
    .modal h2 {
      margin-top: 0;
      font-weight: 700;
      font-size: 1.3rem;
      margin-bottom: 1rem;
    }
    .modal p {
      margin-bottom: 1.5rem;
      white-space: pre-wrap;
      user-select: text;
    }
    .modal button {
      background: var(--primary);
      border: none;
      color: #fff;
      font-weight: 600;
      padding: 0.5rem 1.2rem;
      border-radius: 14px;
      font-size: 1rem;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s;
    }
    .modal button:hover {
      background: #005bb5;
    }

    /* Comments Section */
    .comments-section {
      max-width: 650px;
      margin: 0 auto;
      margin-top: 2rem;
      border-top: 1px solid var(--muted);
      padding-top: 1.5rem;
    }
    .comments-section h3 {
      margin: 0 0 1rem;
      font-weight: 700;
      user-select: none;
    }

    .comment-list {
      list-style: none;
      padding: 0;
      margin: 0 0 1.5rem;
      max-height: 250px;
      overflow-y: auto;
      border-radius: 10px;
      background: var(--card);
      box-shadow: 0 2px 10px var(--shadow);
    }
    .comment-list li {
      padding: 0.7rem 1rem;
      border-bottom: 1px solid var(--muted);
      font-size: 0.9rem;
      color: var(--fg);
      user-select: text;
    }
    .comment-list li:last-child {
      border-bottom: none;
    }

    .comment-input-container {
      display: flex;
      gap: 0.5rem;
    }
    .comment-input {
      flex: 1;
      padding: 0.6rem 1rem;
      border-radius: 16px;
      border: 1px solid var(--muted);
      font-size: 1rem;
      outline-offset: 2px;
      user-select: text;
      background: var(--card);
      color: var(--fg);
      transition: border-color 0.3s;
    }
    .comment-input:focus {
      border-color: var(--primary);
    }
    .comment-submit-btn {
      background: var(--primary);
      border: none;
      color: #fff;
      font-weight: 700;
      padding: 0.6rem 1.2rem;
      border-radius: 16px;
      font-size: 1rem;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s;
      flex-shrink: 0;
    }
    .comment-submit-btn:disabled {
      background: var(--muted);
      cursor: not-allowed;
    }
    .comment-submit-btn:hover:not(:disabled) {
      background: #005bb5;
    }
  </style>
</head>
<body>
  <header>
    CyberChat
    <button class="theme-toggle" onclick="toggleTheme()">Toggle Theme</button>
  </header>

  <main>
    <div id="status"></div>

    <img src="" alt="Post Image" class="post-image" style="display:none" />

    <h1 class="post-title"></h1>

    <div class="post-description"></div>
    <span class="read-more" style="display:none;">Read More</span>

    <div class="post-info" style="<!-- Continued from above -->
    <img src="" alt="Profile Picture" class="profile-pic" />
    <span class="username"></span>
    <span class="views"></span>
    <button class="follow-button" disabled>Follow</button>
  </div>

  <!-- Full Description Modal -->
  <div id="desc-modal" class="modal-overlay" style="display:none;">
    <div class="modal">
      <h2>Full Description</h2>
      <p id="full-description"></p>
      <button onclick="closeDescModal()">OK</button>
    </div>
  </div>

  <!-- Follow Modal -->
  <div id="follow-modal" class="modal-overlay" style="display:none;">
    <div class="modal">
      <p id="follow-modal-message"></p>
      <button onclick="closeFollowModal()">OK</button>
    </div>
  </div>

  <!-- Comments Section -->
  <section class="comments-section">
    <h3>Comments</h3>
    <ul class="comment-list"></ul>
    <div class="comment-input-container">
      <input type="text" class="comment-input" placeholder="Add a comment..." />
      <button class="comment-submit-btn" disabled>Send</button>
    </div>
  </section>

  </main>

<script>
  // Simulated logged-in user info & post data â€” replace with your Firebase auth/data calls
  const loggedInUser = {
    uid: 'user123',
    username: 'frank_the_coder',
    profilePic: 'https://i.pravatar.cc/44?u=user123',
    // Not logged in: set loggedInUser = null
  };

  // Simulated post data (replace with your Firebase post fetching)
  const post = {
    id: 'post001',
    image: 'https://picsum.photos/720/480',
    title: 'Welcome to CyberChat!',
    description: `This is a super neat and very long description that goes beyond 100 characters so that we can test the "Read More" functionality properly. It contains all the juicy details about the post and will definitely hook you in.`,
    user: {
      uid: 'author123',
      username: 'post_author',
      profilePic: 'https://i.pravatar.cc/44?u=author123'
    },
    views: 1234,
    followers: ['user999', 'user456'] // Example followers for checking if loggedInUser already follows
  };

  // Comments store (simulate with array, replace with Firebase real-time)
  let comments = [
    { username: 'jane_doe', text: 'Great post!' },
    { username: 'john_smith', text: 'Loving the vibe here.' },
  ];

  // Elements refs
  const postImage = document.querySelector('.post-image');
  const postTitle = document.querySelector('.post-title');
  const postDescription = document.querySelector('.post-description');
  const readMore = document.querySelector('.read-more');
  const profilePic = document.querySelector('.profile-pic');
  const usernameSpan = document.querySelector('.username');
  const viewsSpan = document.querySelector('.views');
  const followButton = document.querySelector('.follow-button');
  const descModal = document.getElementById('desc-modal');
  const fullDescriptionP = document.getElementById('full-description');
  const followModal = document.getElementById('follow-modal');
  const followModalMessage = document.getElementById('follow-modal-message');
  const commentList = document.querySelector('.comment-list');
  const commentInput = document.querySelector('.comment-input');
  const commentSubmitBtn = document.querySelector('.comment-submit-btn');

  // Helper to show modal with message (iOS style)
  function showFollowModal(message) {
    followModalMessage.textContent = message;
    followModal.style.display = 'flex';
  }
  function closeFollowModal() {
    followModal.style.display = 'none';
  }

  // Show full description modal
  function openDescModal() {
    fullDescriptionP.textContent = post.description;
    descModal.style.display = 'flex';
  }
  function closeDescModal() {
    descModal.style.display = 'none';
  }

  // Render Post
  function renderPost() {
    postImage.src = post.image;
    postImage.style.display = 'block';

    postTitle.textContent = post.title;

    // Show first 100 chars or less, add '...' if longer
    if (post.description.length > 100) {
      postDescription.textContent = post.description.slice(0, 100) + '...';
      readMore.style.display = 'block';
    } else {
      postDescription.textContent = post.description;
      readMore.style.display = 'none';
    }

    profilePic.src = post.user.profilePic || 'https://via.placeholder.com/44?text=?';
    profilePic.alt = post.user.username + ' profile picture';

    usernameSpan.textContent = post.user.username;
    viewsSpan.textContent = post.views + ' views';

    // Follow button logic
    if (!loggedInUser) {
      followButton.disabled = true;
      followButton.textContent = 'Login to Follow';
    } else if (loggedInUser.uid === post.user.uid) {
      followButton.disabled = true;
      followButton.textContent = 'You';
    } else if (post.followers.includes(loggedInUser.uid)) {
      followButton.disabled = false;
      followButton.textContent = 'Following';
      followButton.dataset.following = 'true';
    } else {
      followButton.disabled = false;
      followButton.textContent = 'Follow';
      followButton.dataset.following = 'false';
    }
  }

  // Read more click
  readMore.addEventListener('click', openDescModal);

  // Follow button click
  followButton.addEventListener('click', () => {
    if (!loggedInUser) {
      showFollowModal('You need to be logged in to follow users.');
      return;
    }
    if (loggedInUser.uid === post.user.uid) {
      showFollowModal("You can't follow yourself.");
      return;
    }

    if (followButton.dataset.following === 'true') {
      // Unfollow
      post.followers = post.followers.filter(uid => uid !== loggedInUser.uid);
      followButton.textContent = 'Follow';
      followButton.dataset.following = 'false';
    } else {
      // Follow
      post.followers.push(loggedInUser.uid);
      followButton.textContent = 'Following';
      followButton.dataset.following = 'true';
    }
  });

  // Render comments
  function renderComments() {
    commentList.innerHTML = '';
    if (comments.length === 0) {
      commentList.innerHTML = '<li>No comments yet. Be the first!</li>';
      return;
    }
    for (const c of comments) {
      const li = document.createElement('li');
      li.textContent = `${c.username}: ${c.text}`;
      commentList.appendChild(li);
    }
  }

  // Enable comment submit button only if input has text and user logged in
  commentInput.addEventListener('input', () => {
    commentSubmitBtn.disabled = !commentInput.value.trim() || !loggedInUser;
  });

  // Comment submit
  commentSubmitBtn.addEventListener('click', () => {
    if (!loggedInUser) {
      showFollowModal('You need to be logged in to comment.');
      return;
    }
    const text = commentInput.value.trim();
    if (!text) return;
    comments.push({ username: loggedInUser.username, text });
    commentInput.value = '';
    commentSubmitBtn.disabled = true;
    renderComments();
  });

  // Theme toggle (dark/light)
  function toggleTheme() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    if (currentTheme === 'dark') {
      document.documentElement.setAttribute('data-theme', 'light');
    } else {
      document.documentElement.setAttribute('data-theme', 'dark');
    }
  }

  // Init render
  renderPost();
  renderComments();
</script>

</body>
</html>