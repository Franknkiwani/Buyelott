<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>
<style>
body { margin:0; padding:0; font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; display:flex; justify-content:center; align-items:flex-start; min-height:100vh; transition:background 0.3s; background: url('https://th.bing.com/th/id/OIG3.Se5lupmP3VcrE_yj1MOQ?w=206&h=206&c=6&o=5&dpr=1.9&pid=ImgGn&ucfimg=1') center/cover no-repeat; color:#fff; flex-direction:column; }

/* Login */
.login-box { width:80%; max-width:380px; background: rgba(28,28,30,0.85); padding:30px; border-radius:22px; box-shadow:0 8px 25px rgba(0,0,0,0.6); backdrop-filter: blur(8px); text-align:center; margin:50px auto; }
.login-box input { width:100%; padding:14px; margin-bottom:15px; border:none; border-radius:14px; background:#3a3a3c; color:#fff; font-size:16px; outline:none; }
.login-box button { width:100%; padding:14px; border:none; border-radius:14px; background:#0a84ff; color:#fff; font-weight:600; font-size:16px; cursor:pointer; transition:0.2s; }
.login-box button:hover { opacity:0.85; }

/* Notifications */
.notification { position: fixed; top:20px; left:50%; transform: translateX(-50%) translateY(-100%); min-width: 250px; max-width: 90%; padding: 15px 20px; border-radius: 16px; font-weight: 600; font-size: 15px; color: #fff; text-align: center; backdrop-filter: blur(10px); opacity: 0; transition: transform 0.4s ease, opacity 0.4s ease; z-index: 9999; }
.notification.success { background:#28cd41; }
.notification.error { background:#ff3b30; }
.notification.show { transform: translateX(-50%) translateY(0); opacity:1; }

/* Admin Panel */
#adminPanel { display:none; width:90%; max-width:900px; padding:20px; background:#000; flex-direction:column; align-items:center; margin:20px auto; }
.request { background:#2c2c2e; padding:15px; margin-bottom:10px; border-radius:12px; width:100%; }
.request img { max-width:100%; border-radius:8px; margin-top:8px; }
.action-btns { display:flex; justify-content:space-between; margin-top:10px; gap:10px; flex-wrap:wrap; }
.approve-btn { flex:1; padding:10px; border:none; border-radius:12px; background:#34c759; color:#fff; cursor:pointer; font-weight:700; }
.reject-btn { flex:1; padding:10px; border:none; border-radius:12px; background:#ff3b30; color:#fff; cursor:pointer; font-weight:700; }
.login-box input {
  width: 80%;          /* Make input 80% width */
  margin: 0 auto 15px; /* Center horizontally and add bottom spacing */
  display: block;      /* Required for margin auto centering */
  padding: 14px;
  border: none;
  border-radius: 14px;
  background: #3a3a3c;
  color: #fff;
  font-size: 16px;
  outline: none;
}
</style>
</head>
<body>

<!-- Login -->
<div class="login-box" id="loginBox">
  <h2>Admin Login</h2>
  <input type="email" id="emailInput" placeholder="Admin Email">
  <input type="password" id="passwordInput" placeholder="Password">
  <button id="loginBtn">Sign In</button>
</div>

<!-- Admin Panel -->
<div id="adminPanel">
  <h2>Live Partnership Requests</h2>
  <div id="requestsContainer">Loading...</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
import { getDatabase, ref, onValue, child, get, push, set, remove } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";

/* ---------- Admin Login ---------- */
const ADMIN_EMAIL = "jekiblox@gmail.com";
const ADMIN_PASS = "jekiblox08042006";

function showNotification(message, type="success", duration=3000){
  const notif = document.createElement("div");
  notif.className = `notification ${type}`;
  notif.innerText = message;
  document.body.appendChild(notif);
  void notif.offsetWidth;
  notif.classList.add("show");
  setTimeout(()=>{ notif.classList.remove("show"); setTimeout(()=>notif.remove(),400); }, duration);
}

document.getElementById("loginBtn").addEventListener("click", loginAdmin);

function loginAdmin(){
  const email = document.getElementById("emailInput").value.trim();
  const password = document.getElementById("passwordInput").value.trim();
  if(email === ADMIN_EMAIL && password === ADMIN_PASS){
    document.getElementById("loginBox").style.display="none";
    document.body.style.background="#000";
    document.getElementById("adminPanel").style.display="flex";
    showNotification("Login successful ✔️","success");
    loadFirebaseData();
  } else {
    showNotification("Invalid admin credentials ❌","error");
  }
}

/* ---------- Firebase Live Data ---------- */
function loadFirebaseData(){
  const firebaseConfig = {
    apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
    authDomain: "itzhoyoo.firebaseapp.com",
    databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
    projectId: "itzhoyoo-f9f7e",
    storageBucket: "itzhoyoo-f9f7e.filestorage.app",
    messagingSenderId: "1094792075584",
    appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5",
    measurementId: "G-LLT6F9WRKH"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);

  signInAnonymously(auth).catch(console.error);

  onAuthStateChanged(auth, user=>{
    if(user){
      const requestsContainer = document.getElementById("requestsContainer");
      const requestsRef = ref(db,'partnershiprequests');

      onValue(requestsRef, async snapshot=>{
        const requests = snapshot.exists() ? snapshot.val() : {};
        const usersSnap = await get(child(ref(db),'users'));
        const users = usersSnap.exists() ? usersSnap.val() : {};

        requestsContainer.innerHTML="";
        if(Object.keys(requests).length===0){
          requestsContainer.innerHTML="<p>No partnership requests yet.</p>";
          return;
        }

        for(const id in requests){
          const req = requests[id];
          const user = users[req.uid] || {name:'Unknown', email:'Unknown', website:'Unknown'};
          const div = document.createElement("div");
          div.className="request";
          div.innerHTML=`
            <strong>Name:</strong> ${user.name}<br>
            <strong>Email:</strong> ${user.email}<br>
            <strong>Website:</strong> ${user.website}<br>
            <strong>Message:</strong> ${req.message}<br>
            <strong>Submitted:</strong> ${new Date(req.timestamp).toLocaleString()}<br>
            ${req.imageURL ? `<img src="${req.imageURL}" alt="Uploaded image">` : ''}
            <div class="action-btns">
              <button class="approve-btn">Approve</button>
              <button class="reject-btn">Reject</button>
            </div>
          `;
          // Approve
          div.querySelector(".approve-btn").addEventListener("click", async ()=>{
            try{
              const partnershipRef = push(ref(db,'partnerships'));
              await set(partnershipRef,{
                uid:req.uid,
                userInfo:user,
                message:req.message,
                imageURL:req.imageURL,
                timestamp:req.timestamp
              });
              await remove(ref(db,`partnershiprequests/${id}`));
              div.remove();
              showNotification("Request approved ✔️","success");
            }catch(err){
              console.error(err);
              showNotification("Error approving request","error");
            }
          });
          // Reject
          div.querySelector(".reject-btn").addEventListener("click", async ()=>{
            if(confirm("Reject this request?")){
              try{
                await remove(ref(db,`partnershiprequests/${id}`));
                div.remove();
                showNotification("Request rejected ❌","error");
              }catch(err){
                console.error(err);
                showNotification("Error rejecting request","error");
              }
            }
          });
          requestsContainer.appendChild(div);
        }
      });
    }
  });
}
</script>

</body>
</html>