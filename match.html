<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin Panel - Matches & Wins</title>
<style>
  body {
    background: #121212;
    color: #eee;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    padding: 1rem;
    max-width: 900px;
    margin: auto;
  }
  h2 {
    border-bottom: 1px solid #333;
    padding-bottom: 0.3rem;
  }
  label {
    display: block;
    margin-top: 0.5rem;
  }
  input, select, button {
    background: #222;
    border: 1px solid #444;
    color: #eee;
    padding: 0.3rem 0.5rem;
    margin-top: 0.2rem;
    width: 100%;
    max-width: 300px;
    border-radius: 6px;
    font-size: 1rem;
  }
  button {
    cursor: pointer;
    background: #007bff;
    border-color: #0056b3;
    margin-top: 0.8rem;
    transition: background-color 0.3s;
  }
  button:hover {
    background: #0056b3;
  }
  .item {
    background: rgba(255 255 255 / 0.05);
    border-radius: 12px;
    padding: 1rem;
    margin: 0.8rem 0;
  }
  .item > div {
    margin-bottom: 0.4rem;
  }
  .flex {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }
  .flex > * {
    flex: 1 1 200px;
  }
  .btn-delete {
    background: #ff4444 !important;
    border-color: #cc0000 !important;
  }
  .btn-edit {
    background: #28a745 !important;
    border-color: #1e7e34 !important;
  }
  .inline-btns {
    margin-top: 0.6rem;
    display: flex;
    gap: 0.6rem;
  }
  small {
    color: #999;
  }
</style>
</head>
<body>

<h1>Admin Panel</h1>

<section id="matches-section">
  <h2>Manage Matches</h2>

  <form id="match-form">
    <input type="hidden" id="match-key" value="" />
    <label>Team 1
      <input type="text" id="team1-input" required />
    </label>
    <label>Team 2
      <input type="text" id="team2-input" required />
    </label>
    <label>Kickoff (ISO date/time)
      <input type="datetime-local" id="kickoff-input" required />
      <small>Use UTC time (ISO format)</small>
    </label>
    <button type="submit" id="match-submit-btn">Add Match</button>
    <button type="button" id="match-cancel-btn" style="display:none; background:#999; border-color:#666;">Cancel Edit</button>
  </form>

  <div id="matches-list"></div>
</section>

<hr style="margin:2rem 0; border-color:#333;" />

<section id="wins-section">
  <h2>Manage Team Wins</h2>

  <form id="wins-form">
    <input type="hidden" id="wins-team-key" value="" />
    <label>Team Name
      <input type="text" id="wins-team-input" required />
    </label>
    <label>Wins Count
      <input type="number" id="wins-count-input" min="0" required />
    </label>
    <button type="submit" id="wins-submit-btn">Add Team Wins</button>
    <button type="button" id="wins-cancel-btn" style="display:none; background:#999; border-color:#666;">Cancel Edit</button>
  </form>

  <div id="wins-list"></div>
</section>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
  import { getDatabase, ref, onValue, push, update, remove, set, child, get } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";
  import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";

  // Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
    authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
    databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
    projectId: "itzhoyoo-f9f7e",
    storageBucket: "itzhoyoo-f9f7e.filestorage.app",
    messagingSenderId: "1094792075584",
    appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);

  // Auto anonymous login
  signInAnonymously(auth).catch(console.error);

  // Elements - Matches
  const matchesListEl = document.getElementById('matches-list');
  const matchForm = document.getElementById('match-form');
  const matchKeyInput = document.getElementById('match-key');
  const team1Input = document.getElementById('team1-input');
  const team2Input = document.getElementById('team2-input');
  const kickoffInput = document.getElementById('kickoff-input');
  const matchSubmitBtn = document.getElementById('match-submit-btn');
  const matchCancelBtn = document.getElementById('match-cancel-btn');

  // Elements - Wins
  const winsListEl = document.getElementById('wins-list');
  const winsForm = document.getElementById('wins-form');
  const winsTeamKeyInput = document.getElementById('wins-team-key');
  const winsTeamInput = document.getElementById('wins-team-input');
  const winsCountInput = document.getElementById('wins-count-input');
  const winsSubmitBtn = document.getElementById('wins-submit-btn');
  const winsCancelBtn = document.getElementById('wins-cancel-btn');

  // Load and render Matches
  function renderMatches(matches) {
    matchesListEl.innerHTML = '';
    if (!matches) {
      matchesListEl.textContent = 'No matches found.';
      return;
    }
    Object.entries(matches).forEach(([key, match]) => {
      const div = document.createElement('div');
      div.className = 'item';

      div.innerHTML = `
        <div><strong>${match.team1}</strong> vs <strong>${match.team2}</strong></div>
        <div>Kickoff: ${new Date(match.kickoff).toLocaleString()}</div>
        <div class="inline-btns">
          <button class="btn-edit" data-key="${key}">Edit</button>
          <button class="btn-delete" data-key="${key}">Delete</button>
        </div>
      `;
      matchesListEl.appendChild(div);
    });
  }

  // Load and render Wins
  function renderWins(wins) {
    winsListEl.innerHTML = '';
    if (!wins) {
      winsListEl.textContent = 'No team wins data found.';
      return;
    }
    Object.entries(wins).forEach(([team, count]) => {
      const div = document.createElement('div');
      div.className = 'item';
      div.innerHTML = `
        <div><strong>${team}</strong>: ${count} wins</div>
        <div class="inline-btns">
          <button class="btn-edit" data-team="${team}">Edit</button>
          <button class="btn-delete" data-team="${team}">Delete</button>
        </div>
      `;
      winsListEl.appendChild(div);
    });
  }

  // Listen to Firebase data
  onValue(ref(db, 'matches'), snapshot => {
    renderMatches(snapshot.val());
  });

  onValue(ref(db, 'wins'), snapshot => {
    renderWins(snapshot.val());
  });

  // Match form submit (create or update)
  matchForm.addEventListener('submit', async e => {
    e.preventDefault();

    const team1 = team1Input.value.trim();
    const team2 = team2Input.value.trim();
    const kickoff = kickoffInput.value;

    if (!team1 || !team2 || !kickoff) {
      alert('Please fill all match fields.');
      return;
    }

    const key = matchKeyInput.value;

    if (key) {
      // Update existing match
      try {
        await update(ref(db, `matches/${key}`), { team1, team2, kickoff: new Date(kickoff).toISOString() });
        resetMatchForm();
      } catch (err) {
        alert('Failed to update match: ' + err.message);
      }
    } else {
      // Add new match
      try {
        const newMatchRef = push(ref(db, 'matches'));
        await set(newMatchRef, { team1, team2, kickoff: new Date(kickoff).toISOString() });
        resetMatchForm();
      } catch (err) {
        alert('Failed to add match: ' + err.message);
      }
    }
  });

  // Match cancel edit button
  matchCancelBtn.addEventListener('click', e => {
    e.preventDefault();
    resetMatchForm();
  });

  // Wins form submit (create or update)
  winsForm.addEventListener('submit', async e => {
    e.preventDefault();

    const team = winsTeamInput.value.trim();
    const winsCount = Number(winsCountInput.value);

    if (!team || isNaN(winsCount) || winsCount < 0) {
      alert('Please enter valid team name and wins count.');
      return;
    }

    const key = winsTeamKeyInput.value;

    if (key) {
      // Update existing wins
      try {
        await update(ref(db, `wins/${key}`), winsCount);
        resetWinsForm();
      } catch (err) {
        alert('Failed to update wins: ' + err.message);
      }
    } else {
      // Add new wins
      try {
        await set(ref(db, `wins/${team}`), winsCount);
        resetWinsForm();
      } catch (err) {
        alert('Failed to add wins: ' + err.message);
      }
    }
  });

  // Wins cancel edit button
  winsCancelBtn.addEventListener('click', e => {
    e.preventDefault();
    resetWinsForm();
  });

  // Click handlers for Edit/Delete buttons (matches)
  matchesListEl.addEventListener('click', e => {
    if (e.target.matches('.btn-edit')) {
      const key = e.target.dataset.key;
      if (!key) return;
      loadMatchForEdit(key);
    } else if (e.target.matches('.btn-delete')) {
      const key = e.target.dataset.key;
      if (!key) return;
      if (confirm('Delete this match?')) {
        remove(ref(db, `matches/${key}`)).catch(err => alert('Delete failed: ' + err.message));
      }
    }
  });

  // Click handlers for Edit/Delete buttons (wins)
  winsListEl.addEventListener('click', e => {
    if (e.target.matches('.btn-edit')) {
      const team = e.target.dataset.team;
      if (!team) return;
      loadWinsForEdit(team);
    } else if (e.target.matches('.btn-delete')) {
      const team = e.target.dataset.team;
      if (!team) return;
      if (confirm(`Delete wins for team "${team}"?`)) {
        remove(ref(db, `wins/${team}`)).catch(err => alert('Delete failed: ' + err.message));
      }
    }
  });

  // Load match data into form for editing
  async function loadMatchForEdit(key) {
    try {
      const snap = await get(ref(db, `matches/${key}`));
      if (!snap.exists()) return alert('Match not found');
      const data = snap.val();
      matchKeyInput.value = key;
      team1Input.value = data.team1;
      team2Input.value = data.team2;
      kickoffInput.value = new Date(data.kickoff).toISOString().slice(0,16); // datetime-local expects YYYY-MM-DDTHH:mm
      matchSubmitBtn.textContent = 'Update Match';
      matchCancelBtn.style.display = 'inline-block';
      team1Input.focus();
    } catch (err) {
      alert('Failed to load match: ' + err.message);
    }
  }

  // Load wins data into form for editing
  async function loadWinsForEdit(team) {
    try {
      const snap = await get(ref(db, `wins/${team}`));
      if (!snap.exists()) return alert('Team wins not found');
      const count = snap.val();
      winsTeamKeyInput.value = team;
      winsTeamInput.value = team;
      winsCountInput.value = count;
      winsSubmitBtn.textContent = 'Update Wins';
      winsCancelBtn.style.display = 'inline-block';
      winsTeamInput.focus();
    } catch (err) {
      alert('Failed to load wins: ' + err.message);
    }
  }

  // Reset match form
  function resetMatchForm() {
    matchKeyInput.value = '';
    team1Input.value = '';
    team2Input.value = '';
    kickoffInput.value = '';
    matchSubmitBtn.textContent = 'Add Match';
    matchCancelBtn.style.display = 'none';
  }

  // Reset wins form
  function resetWinsForm() {
    winsTeamKeyInput.value = '';
    winsTeamInput.value = '';
    winsCountInput.value = '';
    winsSubmitBtn.textContent = 'Add Team Wins';
    winsCancelBtn.style.display = 'none';
  }
</script>

</body>
</html>