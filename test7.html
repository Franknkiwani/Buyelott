<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Unread Messages Notification</title>
<style>
  body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
      Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    background: #121212;
    color: #eee;
  }
  header {
    position: fixed;
    top: 0; left: 0; right: 0;
    height: 56px;
    background: #000;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding: 0 20px;
    box-shadow: 0 2px 8px rgba(255, 255, 255, 0.05);
    user-select: none;
    z-index: 9999;
  }
  #notification {
    position: relative;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  #notification svg {
    width: 28px;
    height: 28px;
    fill: #eee;
    filter: drop-shadow(0 0 1px #0af);
    transition: fill 0.2s ease;
  }
  #notification:hover svg {
    fill: #1da1f2;
  }
  #badge {
    position: absolute;
    top: -6px;
    right: -6px;
    background: #e0245e;
    color: white;
    font-size: 12px;
    font-weight: 700;
    line-height: 1;
    padding: 2px 6px;
    border-radius: 12px;
    user-select: none;
    box-shadow: 0 0 8px #e0245ecc;
    min-width: 20px;
    text-align: center;
  }
</style>
</head>
<body>

<header>
  <div id="notification" role="button" tabindex="0" aria-label="Unread Messages">
    <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
      <path d="M20 2H4C2.9 2 2 2.9 2 4v14l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
    </svg>
    <div id="badge" style="display:none;">0</div>
  </div>
</header>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/11.4.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.4.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.4.0/firebase-database-compat.js"></script>

<script>
  // Your Firebase config here
  const firebaseConfig = {
    apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
    authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
    databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
    projectId: "itzhoyoo-f9f7e",
    storageBucket: "itzhoyoo-f9f7e.filestorage.app",
    messagingSenderId: "1094792075584",
    appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  const badgeEl = document.getElementById('badge');
  const notificationEl = document.getElementById('notification');

  function updateBadge(count) {
    if (count > 0) {
      badgeEl.textContent = count > 99 ? '99+' : count;
      badgeEl.style.display = 'block';
    } else {
      badgeEl.style.display = 'none';
    }
  }

  function listenUnreadMessages(user) {
    if (!user) return;

    // Listen for unreadCounts for the logged-in user in all chats
    const chatsRef = db.ref('/chats');

    chatsRef.on('value', snapshot => {
      const chats = snapshot.val() || {};
      let totalUnread = 0;

      for (const chatId in chats) {
        const meta = chats[chatId].meta;
        if (meta && meta.unreadCounts && meta.unreadCounts[user.uid]) {
          totalUnread += meta.unreadCounts[user.uid];
        }
      }
      updateBadge(totalUnread);
    });
  }

  auth.onAuthStateChanged(user => {
    if (user) {
      listenUnreadMessages(user);
    } else {
      badgeEl.style.display = 'none';
      // Redirect or show login if needed
      console.log('Not logged in');
    }
  });

  // Optional: add click handler on notification icon
  notificationEl.addEventListener('click', () => {
    alert('Open your messages or inbox page here!');
  });
  notificationEl.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      notificationEl.click();
    }
  });
</script>

</body>
</html>