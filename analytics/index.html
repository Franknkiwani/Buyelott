<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Surveoo Dashboard</title>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


  <style>
    /* Your CSS here (same as previous dashboard + chart styles) */
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
        Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      background: #f2f2f7;
      color: #1c1c1e;
      padding: 1rem;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      user-select: none;
    }
    h1 {
      font-weight: 700;
      font-size: 1.8rem;
      margin-bottom: 1rem;
      text-align: center;
      color: #000;
    }
    .dashboard {
      display: flex;
      gap: 1rem;
      justify-content: space-between;
      max-width: 420px;
      margin: 0 auto 2rem auto;
      user-select: none;
    }
    .card {
      flex: 1;
      background: #fff;
      border-radius: 20px;
      padding: 1.5rem 1rem;
      box-shadow: 0 10px 20px rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: box-shadow 0.3s ease;
    }
    .card:hover {
      box-shadow: 0 15px 25px rgba(0,0,0,0.15);
      cursor: default;
    }
    .icon-circle {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: #e5e5ea;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 1rem;
      box-shadow: inset 0 2px 5px rgba(255,255,255,0.8);
    }
    .icon-circle svg {
      width: 26px;
      height: 26px;
      stroke: #007aff;
      stroke-width: 2.5;
      fill: none;
    }
    .stat-number {
      font-weight: 700;
      font-size: 1.5rem;
      color: #000;
      margin-bottom: 0.3rem;
      letter-spacing: 0.05em;
    }
    .stat-label {
      font-weight: 500;
      font-size: 0.9rem;
      color: #636366;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }
    @media (max-width: 360px) {
      .dashboard {
        flex-direction: column;
        max-width: 100%;
      }
      .card {
        margin-bottom: 1rem;
      }
    }
    .chart-container {
      max-width: 420px;
      margin: 0 auto;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.08);
      padding: 1rem;
      user-select: none;
    }
    .toggle-buttons {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1rem;
      user-select: none;
    }
    .toggle-buttons button {
      background: #007aff;
      border: none;
      border-radius: 12px;
      color: white;
      padding: 0.4rem 1rem;
      font-weight: 700;
      font-size: 0.9rem;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0,122,255,0.4);
      transition: background 0.3s ease;
      user-select: none;
      min-width: 80px;
    }
    .toggle-buttons button.active,
    .toggle-buttons button:hover {
      background: #005bb5;
      box-shadow: 0 6px 12px rgba(0,91,181,0.6);
    }
    .chart-container {
  max-width: 420px;
  margin: 0 auto;
  background: #fff;
  border-radius: 20px;
  box-shadow: 0 10px 20px rgba(0,0,0,0.08);
  padding: 1rem;
  height: 260px; /* prevents tall stretching */
}

.chart-container canvas {
  width: 100% !important;
  height: 100% !important; /* forces it to fill container height */
}
  </style>
</head>
<body>
  <h1>Surveoo Dashboard</h1>
  <div class="dashboard">
    <div class="card">
      <div class="icon-circle" aria-label="Views icon">
        <svg viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
          <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z" />
          <circle cx="12" cy="12" r="3" />
        </svg>
      </div>
      <div class="stat-number" id="views-count">0</div>
      <div class="stat-label">Views</div>
    </div>
    <div class="card">
      <div class="icon-circle" aria-label="Clicks icon">
        <svg viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14 2l7 7-7-7zM2 22l12-12-4-4-8 8 4 4z" />
        </svg>
      </div>
      <div class="stat-number" id="clicks-count">0</div>
      <div class="stat-label">Clicks</div>
    </div>
    <div class="card">
      <div class="icon-circle" aria-label="Users icon">
        <svg viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="7" r="4" />
          <path d="M5.5 21a6.5 6.5 0 0113 0" />
        </svg>
      </div>
      <div class="stat-number" id="users-count">0</div>
      <div class="stat-label">Users</div>
    </div>
  </div>

  <div class="chart-container">
    <div class="toggle-buttons">
      <button class="active" data-range="7">Last 7 Days</button>
      <button data-range="30">Last 30 Days</button>
      <button data-range="all">All Time</button>
    </div>
    <canvas id="statsChart" height="180"></canvas>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
    import { getDatabase, ref, onValue, get } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
      authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
      databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
      projectId: "itzhoyoo-f9f7e",
      storageBucket: "itzhoyoo-f9f7e.filestorage.app",
      messagingSenderId: "1094792075584",
      appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5",
      measurementId: "G-LLT6F9WRKH"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Dashboard stats refs
    const viewsRef = ref(db, 'stats/views');
    const clicksRef = ref(db, 'stats/clicks');
    const usersRef = ref(db, 'stats/users');
    const dailyRef = ref(db, 'stats/daily');

    // Update dashboard counts live
    onValue(viewsRef, snapshot => {
      document.getElementById('views-count').textContent = (snapshot.val() || 0).toLocaleString();
    });
    onValue(clicksRef, snapshot => {
      document.getElementById('clicks-count').textContent = (snapshot.val() || 0).toLocaleString();
    });
    onValue(usersRef, snapshot => {
      document.getElementById('users-count').textContent = (snapshot.val() || 0).toLocaleString();
    });

    const ctx = document.getElementById('statsChart').getContext('2d');
    let currentRange = '7';
    let statsChart;

    function parseDailyData(data, range) {
      const dates = Object.keys(data || {}).sort();
      const today = new Date();
      let filteredDates;

      if (range === '7') {
        filteredDates = dates.filter(d => {
          const date = new Date(d);
          return (today - date) / (1000 * 60 * 60 * 24) < 7;
        });
      } else if (range === '30') {
        filteredDates = dates.filter(d => {
          const date = new Date(d);
          return (today - date) / (1000 * 60 * 60 * 24) < 30;
        });
      } else {
        filteredDates = dates;
      }

      filteredDates.sort((a,b) => new Date(a) - new Date(b));

      return {
        labels: filteredDates.map(d => new Date(d).toLocaleDateString(undefined, { month: 'short', day: 'numeric' })),
        views: filteredDates.map(d => data[d]?.views || 0),
        clicks: filteredDates.map(d => data[d]?.clicks || 0),
        users: filteredDates.map(d => data[d]?.users || 0),
      };
    }

    function renderChart(data) {
      if(statsChart) {
        statsChart.data.labels = data.labels;
        statsChart.data.datasets[0].data = data.views;
        statsChart.data.datasets[1].data = data.clicks;
        statsChart.data.datasets[2].data = data.users;
        statsChart.update();
      } else {
        statsChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: data.labels,
            datasets: [
              {
                label: 'Views',
                data: data.views,
                borderColor: '#007aff',
                backgroundColor: 'rgba(0, 122, 255, 0.15)',
                fill: true,
                tension: 0.3,
              },
              {
                label: 'Clicks',
                data: data.clicks,
                borderColor: '#dc2626',
                backgroundColor: 'rgba(220, 38, 38, 0.15)',
                fill: true,
                tension: 0.3,
              },
              {
                label: 'Users',
                data: data.users,
                borderColor: '#28a745',
                backgroundColor: 'rgba(40, 167, 69, 0.15)',
                fill: true,
                tension: 0.3,
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: { beginAtZero: true },
            },
            interaction: { mode: 'nearest', intersect: false },
            plugins: {
              legend: { position: 'top' },
            }
          }
        });
      }
    }

    // Load & render daily data on startup
    get(dailyRef).then(snapshot => {
      const dailyData = snapshot.val() || {};
      renderChart(parseDailyData(dailyData, currentRange));
    }).catch(console.error);

    // Toggle buttons
    document.querySelectorAll('.toggle-buttons button').forEach(button => {
      button.addEventListener('click', () => {
        if (button.dataset.range === currentRange) return;
        currentRange = button.dataset.range;
        document.querySelectorAll('.toggle-buttons button').forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');

        get(dailyRef).then(snapshot => {
          const dailyData = snapshot.val() || {};
          renderChart(parseDailyData(dailyData, currentRange));
        }).catch(console.error);
      });
    });
  </script>
</body>
</html>