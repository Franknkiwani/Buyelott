<!DOCTYPE html>
<html lang="en">
https://cyberchat.online/
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
      Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    display: flex;
    height: 100vh;
    justify-content: center;
    align-items: center;
    background: #121212;
    color: #eee;
    margin: 0;
    text-align: center;
  }
</style>
</head>
<body>
<div id="message">Processing your visit...</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
  import {
    getDatabase,
    ref,
    runTransaction,
    push
  } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
    authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
    databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
    projectId: "itzhoyoo-f9f7e",
    storageBucket: "itzhoyoo-f9f7e.filestorage.app",
    messagingSenderId: "1094792075584",
    appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5",
    measurementId: "G-LLT6F9WRKH"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const messageEl = document.getElementById('message');

  // Extract uid param from URL
  const urlParams = new URLSearchParams(window.location.search);
  const uid = urlParams.get('uid');

  if (!uid) {
    messageEl.textContent = "No referral ID found in URL.";
  } else {
    recordVisit(uid)
      .then(() => {
        messageEl.textContent = "Thanks for visiting! Redirecting...";
        // After a delay, redirect wherever you want, or just show a message
        setTimeout(() => {
          window.location.href = "/"; // or your homepage or anywhere
        }, 2000);
      })
      .catch((err) => {
        console.error(err);
        messageEl.textContent = "Oops, error recording visit.";
      });
  }

  async function recordVisit(uid) {
    const visitsCountRef = ref(db, `referrals/${uid}/visitsCount`);
    const hitsRef = ref(db, `referrals/${uid}/hits`);

    // Atomically increment visitsCount
    await runTransaction(visitsCountRef, (current) => (current || 0) + 1);

    // Push hit details
    const hitData = {
      t: Date.now(),
      ua: navigator.userAgent.slice(0, 140),
      ref: document.referrer ? (document.referrer.length > 120 ? document.referrer.slice(0, 120) : document.referrer) : ""
    };

    await push(hitsRef, hitData);
  }
</script>
</body>
</html>