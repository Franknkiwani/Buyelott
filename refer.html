<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Connect with Singles Near You</title>
  
  <!-- Meta Description for SEO -->
  <meta name="description" content="Join the best dating platform to connect with singles near you. Start chatting, make real connections, and find love today!">
  
  <!-- Open Graph for Social Preview -->
  <meta property="og:title" content="Connect with Singles Near You">
  <meta property="og:description" content="Meet singles in your area and start building real connections today.">
  <meta property="og:image" content="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTPe8kR5mog4WmSZ8rxZb8g1LBb_XaxWkO9osW4u4RiYGS91DKtolbWmGrr&s=10">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://yourwebsite.com">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Connect with Singles Near You">
  <meta name="twitter:description" content="Join the best dating platform to meet singles near you. Start chatting today!">
  <meta name="twitter:image" content="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTPe8kR5mog4WmSZ8rxZb8g1LBb_XaxWkO9osW4u4RiYGS91DKtolbWmGrr&s=10">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSm5DcYHABRR_pM7K2RTyYGelcMZ8oR8CPUUelJ2x3yQEMCqGQPaI6USjhc&s=10">
</head>
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
      Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    display: flex;
    height: 100vh;
    justify-content: center;
    align-items: center;
    background: #121212;
    color: #eee;
    margin: 0;
    text-align: center;
  }
</style>
</head>
<body>
<div id="message">Processing your visit...</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
  import {
    getDatabase,
    ref,
    runTransaction,
    push
  } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
    authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
    databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
    projectId: "itzhoyoo-f9f7e",
    storageBucket: "itzhoyoo-f9f7e.filestorage.app",
    messagingSenderId: "1094792075584",
    appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5",
    measurementId: "G-LLT6F9WRKH"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const messageEl = document.getElementById('message');

  // Extract uid param from URL
  const urlParams = new URLSearchParams(window.location.search);
  const uid = urlParams.get('uid');

  if (!uid) {
    messageEl.textContent = "No referral ID found in URL.";
  } else {
    recordVisit(uid)
      .then(() => {
        messageEl.textContent = "Thanks for visiting! Redirecting...";
        // After a delay, redirect wherever you want, or just show a message
        setTimeout(() => {
          window.location.href = "/"; // or your homepage or anywhere
        }, 2000);
      })
      .catch((err) => {
        console.error(err);
        messageEl.textContent = "Oops, error recording visit.";
      });
  }

  async function recordVisit(uid) {
    const visitsCountRef = ref(db, `referrals/${uid}/visitsCount`);
    const hitsRef = ref(db, `referrals/${uid}/hits`);

    // Atomically increment visitsCount
    await runTransaction(visitsCountRef, (current) => (current || 0) + 1);

    // Push hit details
    const hitData = {
      t: Date.now(),
      ua: navigator.userAgent.slice(0, 140),
      ref: document.referrer ? (document.referrer.length > 120 ? document.referrer.slice(0, 120) : document.referrer) : ""
    };

    await push(hitsRef, hitData);
  }
</script>
</body>
</html>