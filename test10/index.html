<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WATCH-4-RBX</title>
<style>
/* Global reset & font */
*{
  margin:0;padding:0;box-sizing:border-box;
  font-family:-apple-system,BlinkMacSystemFont,'SF Pro',sans-serif;
  user-select:none;
  -webkit-tap-highlight-color:transparent;
}
body{background:#0a0a0a;color:#fff;height:100vh;display:flex;flex-direction:column;overflow:hidden;}
header{
  position:sticky;top:0;padding:12px 20px;
  display:flex;justify-content:space-between;align-items:center;
  backdrop-filter:blur(20px);background:rgba(255,255,255,0.05);
  border-bottom:1px solid rgba(255,255,255,0.1);z-index:100;
}
.left{display:flex;align-items:center;gap:10px;}
.left img{width:26px;height:26px;}
.left h1{font-size:1.2rem;}

/* Buttons */
.register-btn{
  background: rgba(255,255,255,0.05);
  border:1px solid rgba(255,255,255,0.3);
  color:#fff;font-weight:700;padding:8px 16px;border-radius:12px;
  cursor:pointer;transition:0.3s ease;
}
.register-btn:hover{background: rgba(255,255,255,0.1);transform: scale(1.05);}
.register-btn:active{transform: scale(0.95);}

.rbx {
  background: rgba(0,0,0,0.35);
  border: 1px solid rgba(255,255,255,0.2);
  color: #fff;font-weight:700;padding:8px 16px;border-radius:12px;
  cursor:pointer;backdrop-filter: blur(6px);transition:0.2s ease;
}
.rbx:hover {transform:scale(1.05);}
.rbx:active {transform:scale(0.95);}

/* User actions */
.user-actions{display:flex;align-items:center;gap:10px;position:relative;}
.logout-icon{width:24px;height:24px;cursor:pointer;transition:0.2s;}
.logout-icon:hover{transform: rotate(15deg) scale(1.1);}
.logout-menu{
  display:none;position:absolute;right:0;top:120%;
  background:#120000;border:1px solid rgba(255,77,77,.6);
  border-radius:12px;padding:6px;box-shadow:0 0 15px rgba(255,77,77,.4);
}
.logout-menu.show{display:block;opacity:1;pointer-events:auto;transition:0.2s ease;}
.logout-menu button{
  background:none;border:none;color:#ff4d4d;font-weight:700;
  padding:8px 16px;border-radius:10px;cursor:pointer;
}
.logout-menu button:hover{background:rgba(255,77,77,.15);}

/* Modal */
.modal{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,.7);backdrop-filter:blur(15px);
  z-index:200;justify-content:center;align-items:center;
}
.modal-box{
  position:relative;width:90%;max-width:420px;
  background:#0f0f0f;border-radius:18px;padding:20px;
}

/* Close button SVG top-left */
.modal-close{
  position:absolute;top:10px;left:10px;background:none;border:none;padding:0;cursor:pointer;
}
.modal-close svg{width:28px;height:28px;transition:0.2s ease;}
.modal-close svg:hover{transform:scale(1.1);}

/* Modal content */
.balance-big{text-align:center;font-size:2.2rem;font-weight:800;margin-top:10px;animation:pulse 1.2s ease infinite alternate;}
@keyframes pulse{0%{transform:scale(1);}100%{transform:scale(1.05);}}
.sub{text-align:center;opacity:.7;margin-bottom:10px;}
.notice{text-align:center;font-size:.85rem;margin-bottom:15px;}
input,textarea{
  width:100%;background: rgba(0,0,0,0.3);
  border:1px solid rgba(255,255,255,0.3);border-radius:10px;padding:10px;color:#fff;margin-bottom:10px;
}
input:focus,textarea:focus{border-color:#fff;outline:none;}
textarea{resize:none;height:70px;}
.confirm{
  width:100%;padding:12px;border:none;border-radius:12px;font-weight:700;
  cursor:pointer;background:#fff;color:#000;transition:0.2s;
}
.confirm:hover{transform:scale(1.03);}
.msg{text-align:center;margin-top:10px;font-weight:600;}
.error{color:#ff4d4d;}
.success{color:#00ff99;}
.history{margin-top:15px;font-size:.85rem;opacity:.8;}
</style>
</head>
<body>

<header>
  <div class="left">
    <img src="https://img.icons8.com/ios-filled/50/ffffff/robux.png">
    <h1>WATCH-4-RBX</h1>
  </div>
  <div id="headerRight">
    <button class="register-btn" onclick="location.href='register/'">REGISTER</button>
  </div>
</header>

<!-- WITHDRAW MODAL -->
<div class="modal" id="withdrawModal">
  <div class="modal-box">
    <button class="modal-close" onclick="document.getElementById('withdrawModal').style.display='none'">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
        <path fill="#fb7369" d="m68.77,50c5.01-5.33,9.92-10.79,14.74-16.45,2-2.36,1.98-5.82-.01-8.19-2.69-3.2-5.65-6.17-8.86-8.86-2.37-1.99-5.84-2.02-8.19-.01-5.66,4.82-11.12,9.73-16.45,14.74-5.33-5.01-10.79-9.92-16.45-14.74-2.36-2-5.82-1.98-8.19.01-3.2,2.69-6.17,5.65-8.86,8.86-1.99,2.37-2.02,5.84-.01,8.19,4.82,5.66,9.73,11.12,14.74,16.45-5.01,5.33-9.92,10.79-14.74,16.45-2,2.36-1.98,5.82.01,8.19,2.69,3.2,5.65,6.17,8.86,8.86,2.37,1.99,5.84,2.02,8.19.01,5.66-4.82,11.12-9.73,16.45-14.74,5.33,5.01,10.79,9.92,16.45,14.74,2.36,2,5.82,1.98,8.19-.01,3.2-2.69,6.17-5.65,8.86-8.86,1.99-2.37,2.02-5.84.01-8.19-4.82-5.66-9.73-11.12-14.74-16.45Z"></path>
      </svg>
    </button>
    <div class="balance-big" id="bigBal">0 RBX</div>
    <div class="sub">Available balance</div>
    <div class="notice">Once you reach <b>150 RBX</b>, you can redeem for real Robux</div>
    <input id="robloxUser" placeholder="@roblox username">
    <textarea id="extraInfo" placeholder="More info (optional)"></textarea>
    <button class="confirm" onclick="confirmWithdraw()">CONFIRM</button>
    <div class="msg" id="msg"></div>
    <div class="history" id="history"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";
import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

const firebaseConfig={
  apiKey:"AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
  authDomain:"itzhoyoo-f9f7e.firebaseapp.com",
  databaseURL:"https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
  projectId:"itzhoyoo-f9f7e",
  storageBucket:"itzhoyoo-f9f7e.filestorage.app",
  messagingSenderId:"1094792075584",
  appId:"1:1094792075584:web:d49e9c3f899d3cd31082a5"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getDatabase(app);

let currentUser,balance=0;
const headerRight=document.getElementById("headerRight");

window.openModal=()=>document.getElementById("withdrawModal").style.display="flex";

window.toggleLogout=()=>{
  const menu=document.getElementById("logoutMenu");
  menu.classList.toggle('show');
};

window.doLogout=async()=>{await signOut(auth);location.reload();};

onAuthStateChanged(auth,async user=>{
  if(!user){
    headerRight.innerHTML = `<button class="register-btn" onclick="location.href='register/'">REGISTER</button>`;
    return;
  }
  currentUser=user;
  const balRef = ref(db,`users/${user.uid}/rbxbalance`);
  onValue(balRef,snap=>{
    balance = snap.exists()?snap.val():0;
    document.getElementById("bigBal").innerText=balance+" RBX";
    const rbxBtn = document.querySelector(".rbx");
    if(rbxBtn) rbxBtn.innerText = balance+" RBX / GET";
  });

  headerRight.innerHTML=`
    <div class="user-actions">
      <div class="rbx" onclick="openModal()">${balance} RBX / GET</div>
      <img class="logout-icon" src="https://i.imgur.com/Lvfvc4a.png" onclick="toggleLogout()">
      <div class="logout-menu" id="logoutMenu">
        <button onclick="doLogout()">Logout</button>
      </div>
    </div>`;
});

window.confirmWithdraw=async()=>{
  const msg=document.getElementById("msg");
  msg.className="msg";
  if(balance<150){msg.textContent="You need at least 150 RBX";msg.classList.add("error");return;}
  if(!robloxUser.value){msg.textContent="Please enter your Roblox username";msg.classList.add("error");return;}
  await push(ref(db,`confirmedrbx/${currentUser.uid}`),{
    amount:150,
    roblox:robloxUser.value,
    info:extraInfo.value,
    status:"pending",
    time:Date.now()
  });
  msg.textContent="Withdrawal submitted";msg.classList.add("success");
  robloxUser.value=""; extraInfo.value="";
};

window.onclick = (e) => {
  const menu = document.getElementById("logoutMenu");
  const modal = document.getElementById("withdrawModal");
  if(e.target === modal) modal.style.display="none";
  if(menu && !menu.contains(e.target) && e.target.closest('.logout-icon')===null) menu.classList.remove('show');
};
window.addEventListener('keydown', e => {if(e.key==='Escape') document.getElementById("withdrawModal").style.display="none";});
</script>
</body>
</html>