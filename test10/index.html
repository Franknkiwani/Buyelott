<!DOCTYPE html>  
<html lang="en">  
<head>  
<meta charset="UTF-8">  
<meta name="viewport" content="width=device-width, initial-scale=1.0">  
<title>WATCH-4-RBX</title>  
<style>  
/* Global reset & font */  
*{  
  margin:0;padding:0;box-sizing:border-box;  
  font-family:-apple-system,BlinkMacSystemFont,'SF Pro',sans-serif;  
  user-select:none;  
  -webkit-tap-highlight-color:transparent;  
}  
body {
  background:#0a0a0a;
  color:#fff;
  min-height:100vh; /* keep full height */
  display:flex;
  flex-direction:column;
  overflow-y: auto; /* allow vertical scroll */
}
header{  
  position:sticky;top:0;padding:12px 20px;  
  display:flex;justify-content:space-between;align-items:center;  
  backdrop-filter:blur(20px);background:rgba(255,255,255,0.05);  
  border-bottom:1px solid rgba(255,255,255,0.1);z-index:100;  
}  
.left{display:flex;align-items:center;gap:10px;}  
.left img{width:26px;height:26px;}  
.left h1{font-size:1.2rem;}  
  
/* Buttons */  
.register-btn{  
  background: rgba(255,255,255,0.05);  
  border:1px solid rgba(255,255,255,0.3);  
  color:#fff;font-weight:700;padding:8px 16px;border-radius:12px;  
  cursor:pointer;transition:0.3s ease;  
}  
.register-btn:hover{background: rgba(255,255,255,0.1);transform: scale(1.05);}  
.register-btn:active{transform: scale(0.95);}  
  
.rbx {  
  background: rgba(0,0,0,0.35);  
  border: 1px solid rgba(255,255,255,0.2);  
  color: #fff;font-weight:700;padding:8px 16px;border-radius:12px;  
  cursor:pointer;backdrop-filter: blur(6px);transition:0.2s ease;  
}  
.rbx:hover {transform:scale(1.05);}  
.rbx:active {transform:scale(0.95);}  
  
/* User actions */  
.user-actions{display:flex;align-items:center;gap:10px;position:relative;}  
.logout-icon{width:24px;height:24px;cursor:pointer;transition:0.2s;}  
.logout-icon:hover{transform: rotate(15deg) scale(1.1);}  
.logout-menu{  
  display:none;position:absolute;right:0;top:120%;  
  background:#120000;border:1px solid rgba(255,77,77,.6);  
  border-radius:12px;padding:6px;box-shadow:0 0 15px rgba(255,77,77,.4);  
}  
.logout-menu.show{display:block;opacity:1;pointer-events:auto;transition:0.2s ease;}  
.logout-menu button{  
  background:none;border:none;color:#ff4d4d;font-weight:700;  
  padding:8px 16px;border-radius:10px;cursor:pointer;  
}  
.logout-menu button:hover{background:rgba(255,77,77,.15);}  
  
/* Modal */  
.modal{  
  display:none;position:fixed;inset:0;  
  background:rgba(0,0,0,.7);backdrop-filter:blur(15px);  
  z-index:200;justify-content:center;align-items:center;  
}  
.modal-box{  
  position:relative;width:90%;max-width:420px;  
  background:#0f0f0f;border-radius:18px;padding:20px;  
}  
  
/* Close button SVG top-left */  
.modal-close{  
  position:absolute;top:10px;left:10px;background:none;border:none;padding:0;cursor:pointer;  
}  
.modal-close svg{width:28px;height:28px;transition:0.2s ease;}  
.modal-close svg:hover{transform:scale(1.1);}  
  
/* Modal content */  
.balance-big{text-align:center;font-size:2.2rem;font-weight:800;margin-top:10px;animation:pulse 1.2s ease infinite alternate;}  
@keyframes pulse{0%{transform:scale(1);}100%{transform:scale(1.05);}}  
.sub{text-align:center;opacity:.7;margin-bottom:10px;}  
.notice{text-align:center;font-size:.85rem;margin-bottom:15px;}  
input,textarea{  
  width:100%;background: rgba(0,0,0,0.3);  
  border:1px solid rgba(255,255,255,0.3);border-radius:10px;padding:10px;color:#fff;margin-bottom:10px;  
}  
input:focus,textarea:focus{border-color:#fff;outline:none;}  
textarea{resize:none;height:70px;}  
.confirm{  
  width:100%;padding:12px;border:none;border-radius:12px;font-weight:700;  
  cursor:pointer;background:#fff;color:#000;transition:0.2s;  
}  
.confirm:hover{transform:scale(1.03);}  
.msg{text-align:center;margin-top:10px;font-weight:600;}  
.error{color:#ff4d4d;}  
.success{color:#00ff99;}  
.history{margin-top:15px;font-size:.85rem;opacity:.8;}  

/* ====== Video Container ====== */
#videoContainer {
  width: 90% !important;
  max-width: 800px;
  margin: 20px auto;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* Video wrapper (to keep aspect ratio) */
#videoContainer > div:first-child {
  width: 100%;
  border-radius: 20px;
  overflow: hidden;
}

/* ====== Potential Reward Box ====== */
#potentialReward {
  width 90%;
  max-width: 480px;
  margin: 16px auto;
  text-align: center;
  padding: 12px 16px;
  border-radius: 16px;
  background: rgba(255,255,255,0.05);
  color: #fff;
  font-weight: 700;
}
.section{
  flex:0 0 48%;
  background: rgba(25,25,35,0.6); /* slightly transparent flat background */
  border-radius:18px;
  padding:25px;
  text-align:center;
  backdrop-filter:blur(0); /* remove blur if you want */
  box-shadow:none; /* optional: remove shadow */
  cursor:pointer;
}
.donate-btn {
  padding:6px 14px;
  border-radius:12px;
  font-weight:700;
  cursor:pointer;
  backdrop-filter:blur(6px);
  color:#fff;
  background: rgba(0,0,0,0.35);
  border: 2px solid #fff;
  transition: 0.2s;
}

.donate-btn:hover { transform: scale(1.05); }
.donate-btn:active { transform: scale(0.95); }

/* Rank colors */
.donate-gold { border-color: gold; }
.donate-cyan { border-color: cyan; }
.donate-brown { border-color: sienna; }
</style>  
</head>  
<body>  
  
<header>  
  <div class="left">  
    <img src="https://img.icons8.com/ios-filled/50/ffffff/robux.png">  
    <h1>WATCH-4-RBX</h1>  
  </div>  
  <div id="headerRight">  
    <button class="register-btn" onclick="location.href='register/'">REGISTER</button>  
  </div>  
</header>  
<!-- Top Sections Above Video -->  
<div class="top-sections" style="display:flex; justify-content:space-between; gap:4%; margin:20px 10px;">
  <div class="section" style="border:none !important; box-shadow:none !important; background:transparent !important; backdrop-filter:none !important; padding:25px; text-align:center; cursor:pointer;">
    <img src="https://img.icons8.com/ios-filled/50/ffffff/gift.png"/>
    <span style="display:block; font-size:0.95rem; font-weight:500; color:#fff;">Redeem rewards</span>
  </div>
  <div class="section" style="border:none !important; box-shadow:none !important; background:transparent !important; backdrop-filter:none !important; padding:25px; text-align:center; cursor:pointer;">
    <img src="https://img.icons8.com/ios-filled/50/ffffff/share.png"/>
    <span style="display:block; font-size:0.95rem; font-weight:500; color:#fff;">Refer & Earn</span>
  </div>
</div>
</div>  
<div id="videoContainer" style="position:relative;width:100%;max-width:640px;margin:20px auto;">  
  
  <div style="position:relative;width:100%;padding-top:56.25%;background:#000;border-radius:20px;overflow:hidden;">  
    <video id="player"  
      poster="https://i.ytimg.com/vi/P-vP6JkrIMs/maxresdefault.jpg"  
      style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:contain;">  
    </video>  
  <button id="prevBtn"  
  style="position:absolute;bottom:10px;left:10px;padding:10px 20px;border-radius:20px;border:1px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.05);color:#fff;font-weight:600;cursor:pointer;transition:all 0.2s;">  
  Previous  
</button>  

<button id="nextBtn"  
  style="position:absolute;bottom:10px;right:10px;padding:10px 20px;border-radius:20px;border:1px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.05);color:#fff;font-weight:600;cursor:pointer;transition:all 0.2s;">  
  Next  
</button>
</div>
  <div id="timeCounter"  
    style="position:absolute;top:10px;right:10px;padding:6px 12px;border-radius:12px;background:rgba(0,0,0,0.6);color:#fff;">  
    0:00  
  </div>  
  
  <div style="width:100%;height:8px;background:rgba(255,255,255,0.2);border-radius:4px;margin-top:10px;overflow:hidden;">  
    <div id="progressBar" style="height:100%;width:0%;background:red;"></div>  
  </div>  
  
  <div id="loaderPill"  
    style="display:none;margin:10px auto;padding:6px 14px;border-radius:20px;background:rgba(255,0,0,0.15);color:red;">  
    Network is slow  please wait
  </div>  
  
 <div id="potentialReward"  
     style="margin-top:10px;padding:12px;border-radius:20px;background:rgba(255,255,255,0.05);color:#fff;text-align:center;width:80%;max-width:480px;margin-left:auto;margin-right:auto;">  
     
  <div id="rewardNumber" style="font-size:28px;font-weight:700;">0</div>  
  <div>Potential reward</div>  
  
 <button id="startBtn"  
  style="margin:15px auto 0; display:block; width:90%; padding:12px 0; border:2px solid #fff; border-radius:20px; background:#000; color:#fff; font-weight:600; cursor:pointer;">  
  Start Watching  
</button>
</div>
  
</div>  
<div id="topUsers" style="margin:16px 0;"></div>

<!-- Reward Popup -->  
<div id="rewardPopup"  
  style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);  
  background:rgba(20,20,20,0.95);padding:28px;border-radius:26px;  
  min-width:260px;display:flex;flex-direction:column;align-items:center;color:#fff;">  
    
  <img src="https://img.icons8.com/clouds/100/robux.png" style="width:60px;margin-bottom:14px;">  
<div id="rewardMessage" style="font-size:20px;font-weight:700;"></div>
  <div id="loginNotice" style="display:none;color:#ff3b30;font-size:12px;margin-top:6px;">  
    Log in to save your RBX  
  </div>  
  
  <button id="rewardOkButton"  
    style="margin-top:16px;padding:10px 22px;border:none;border-radius:14px;  
    background:#007aff;color:#fff;font-weight:600;">  
    OK  
  </button>  
</div>  
  <!-- Donate Modal -->
<div class="modal" id="donateModal">
  <div class="modal-box" style="max-width:400px;">
    <button class="modal-close" onclick="closeDonateModal()">
      ✕
    </button>
    <h3 style="text-align:center;margin-bottom:10px;">Donate RBX</h3>
    <div style="margin-bottom:8px;text-align:center;">
      <span id="donateTargetName" style="font-weight:700;"></span>
    </div>
    <div style="margin-bottom:8px;text-align:center;">
      Current RBX: <span id="donateTargetBalance">0</span>
    </div>
    <input type="number" id="donateAmount" min="1" max="1000" placeholder="Amount to donate" style="
      width:100%;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,0.3);
      background: rgba(0,0,0,0.3); color:#fff;margin-bottom:12px;
    ">
    <button id="donateConfirm" class="confirm" style="width:100%;">Donate</button>
  </div>
</div>
  
<style>  
.top-sections{  
  display:flex;  
  justify-content:space-between;  
  margin:20px 10px;  
  gap:4%;  
}  
.section{  
  flex:0 0 48%;  
  background: rgba(25,25,35,0.8);  
  border-radius:18px;  
  padding:25px;  
  text-align:center;  
  backdrop-filter:blur(10px);  
  border:1px solid rgba(255,255,255,0.1);  
  box-shadow:0 8px 20px rgba(0,0,0,0.3);  
  transition: transform 0.2s ease, box-shadow 0.2s ease;  
  cursor:pointer;  
}  
.section:hover{  
  transform:translateY(-4px);  
  box-shadow:0 12px 30px rgba(0,0,0,0.4);  
}  
.section img{  
  width:36px;  
  height:36px;  
  margin-bottom:10px;  
}  
.section span{  
  display:block;  
  font-size:0.95rem;  
  font-weight:500;  
  color:#fff;  
}  
</style>  
<!-- WITHDRAW MODAL -->  
<div class="modal" id="withdrawModal">  
  <div class="modal-box">  
    <button class="modal-close" onclick="document.getElementById('withdrawModal').style.display='none'">  
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">  
        <path fill="#fb7369" d="m68.77,50c5.01-5.33,9.92-10.79,14.74-16.45,2-2.36,1.98-5.82-.01-8.19-2.69-3.2-5.65-6.17-8.86-8.86-2.37-1.99-5.84-2.02-8.19-.01-5.66,4.82-11.12,9.73-16.45,14.74-5.33-5.01-10.79-9.92-16.45-14.74-2.36-2-5.82-1.98-8.19.01-3.2,2.69-6.17,5.65-8.86,8.86-1.99,2.37-2.02,5.84-.01,8.19,4.82,5.66,9.73,11.12,14.74,16.45-5.01,5.33-9.92,10.79-14.74,16.45-2,2.36-1.98,5.82.01,8.19,2.69,3.2,5.65,6.17,8.86,8.86,2.37,1.99,5.84,2.02,8.19.01,5.66-4.82,11.12-9.73,16.45-14.74,5.33,5.01,10.79,9.92,16.45,14.74,2.36,2,5.82,1.98,8.19-.01,3.2-2.69,6.17-5.65,8.86-8.86,1.99-2.37,2.02-5.84.01-8.19-4.82-5.66-9.73-11.12-14.74-16.45Z"></path>  
      </svg>  
    </button>  
    <div class="balance-big" id="bigBal">0 RBX</div>  
    <div class="sub">Available balance</div>  
    <div class="notice">Once you reach <b>150 RBX</b>, you can redeem for real Robux</div>  
    <input id="robloxUser" placeholder="@roblox username">  
    <textarea id="extraInfo" placeholder="More info (optional)"></textarea>  
    <button class="confirm" onclick="confirmWithdraw()">CONFIRM</button>  
    <div class="msg" id="msg"></div>  
    <div class="history" id="history"></div>  
  </div>  
</div>  
  
<!-- Referral Modal -->  
<div class="modal" id="referModal">  
  <div class="modal-box">  
    <button class="modal-close" onclick="document.getElementById('referModal').style.display='none'">  
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">  
        <path fill="#fb7369" d="M68.77,50c5.01-5.33,9.92-10.79,14.74-16.45,2-2.36,1.98-5.82-.01-8.19-2.69-3.2-5.65-6.17-8.86-8.86-2.37-1.99-5.84-2.02-8.19-.01-5.66,4.82-11.12,9.73-16.45,14.74-5.33-5.01-10.79-9.92-16.45-14.74-2.36-2-5.82-1.98-8.19.01-3.2,2.69-6.17,5.65-8.86,8.86-1.99,2.37-2.02,5.84-.01,8.19,4.82,5.66,9.73,11.12,14.74,16.45-5.01,5.33-9.92,10.79-14.74,16.45-2,2.36-1.98,5.82.01,8.19,2.69,3.2,5.65,6.17,8.86,8.86,2.37,1.99,5.84,2.02,8.19.01,5.66-4.82,11.12-9.73,16.45-14.74,5.33,5.01,10.79,9.92,16.45,14.74,2.36,2,5.82,1.98,8.19-.01,3.2-2.69,6.17-5.65,8.86-8.86,1.99-2.37,2.02-5.84.01-8.19-4.82-5.66-9.73-11.12-14.74-16.45Z"/>  
      </svg>  
    </button>  
    <div id="referContent" style="text-align:center;">  
      <h2>Refer & Earn</h2>  
      <div id="referMsg" style="margin-bottom:10px;"></div>  
      <input id="referLink" readonly style="margin-bottom:10px;">  
      <button class="confirm" id="copyReferBtn">Copy Link</button>  
      <div style="margin-top:15px;">  
        <span id="referStats">Referred Users: 0 | Clicks: 0 | RBX Earned: 0</span>  
      </div>  
    </div>  
  </div>  
</div>  
<!-- Comment Section inside FAQ -->
<div id="faqComments" style="margin-top:24px; width:90%; margin:0 auto;">
  <h3 style="font-size:1.2rem; margin-bottom:12px; text-align:center; color:#ffcc00;">
    Leave a Comment
  </h3>

  <!-- Comment Form -->
  <div style="display:flex; flex-direction:column; gap:10px; max-width:480px; margin:0 auto;">
    <textarea id="commentInput" placeholder="Write your comment..." style="
      background: rgba(0,0,0,0.3);
      border:1px solid rgba(255,255,255,0.2);
      border-radius:12px;
      padding:10px;
      color:#fff;
      resize:none;
      height:70px;
    "></textarea>
   <button id="submitComment" style="
  background:#000;
  color:#fff;
  border:2px solid #fff;
  padding:10px;
  border-radius:12px;
  font-weight:700;
  cursor:pointer;
">Submit</button>
  </div>

  <!-- Top Comments -->
  <div id="topComments" style="margin-top:20px; display:flex; flex-direction:column; gap:12px;"></div>
</div>
<!-- FAQ Section -->
<div id="faqSection" style="
  margin:24px 10px;
  padding:16px;
  border-radius:20px;
  background:#000;  /* full black */
  color:#fff;
  text-shadow:none;
">
  <h2 style="
    font-size:1.3rem;
    margin-bottom:16px;
    text-align:center;
    color:#fff;
    text-shadow:none;
  ">
    Frequently Asked Questions
  </h2>
  <div id="faqContainer" style="
    display:flex;
    flex-direction:column;
    gap:12px;
  ">
    <!-- Example FAQ card -->
    <div style="
      padding:12px;
      border-radius:16px;
      background:#000;  /* full black */
      color:#fff;
      text-shadow:none;
      box-shadow:none;
      cursor:pointer;
    ">
      What is this site about?
    </div>
    <div style="
      padding:12px;
      border-radius:16px;
      background:#000;  /* full black */
      color:#fff;
      text-shadow:none;
      box-shadow:none;
      cursor:pointer;
    ">
      How do I earn rewards?
    </div>
  </div>
</div>
</div>
<script type="module">  
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";  
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";  
import { getDatabase, ref, push, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";  
  
// ====== Firebase Config ======  
const firebaseConfig = {  
  apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",  
  authDomain: "itzhoyoo-f9f7e.firebaseapp.com",  
  databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",  
  projectId: "itzhoyoo-f9f7e",  
  storageBucket: "itzhoyoo-f9f7e.filestorage.app",  
  messagingSenderId: "1094792075584",  
  appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5"  
};  
  
// ====== Initialize Firebase ======  
const app = initializeApp(firebaseConfig);  
const auth = getAuth(app);  
const db = getDatabase(app);  
  
let currentUser = null, balance = 0;  
  
// ====== DOM Elements ======  
const headerRight = document.getElementById("headerRight");  
const withdrawModal = document.getElementById("withdrawModal");  
const referModal = document.getElementById("referModal");  
const referMsg = document.getElementById("referMsg");  
const referLinkInput = document.getElementById("referLink");  
const referStats = document.getElementById("referStats");  
const copyReferBtn = document.getElementById("copyReferBtn");  
const sections = document.querySelectorAll('.top-sections .section');  
  
// ====== Toast Function ======  
function showToast(msg) {  
  let t = document.getElementById('toast');  
  if(!t){  
    t = document.createElement('div');  
    t.id = 'toast';  
    t.style.cssText = `  
      position:fixed;bottom:20px;left:50%;  
      transform:translateX(-50%);  
      background:rgba(255,255,255,0.15);  
      backdrop-filter:blur(12px);  
      color:#fff;padding:12px 24px;border-radius:20px;font-weight:700;opacity:0;transition:0.3s;  
      z-index:999;  
    `;  
    document.body.appendChild(t);  
  }  
  t.textContent = msg;  
  t.style.opacity = 1;  
  setTimeout(() => { t.style.opacity = 0; }, 2500);  
}  
  
// ====== Handle Auth State ======  
onAuthStateChanged(auth, user => {  
  if(!user){  
    headerRight.innerHTML = `<button class="register-btn" onclick="location.href='register/'">REGISTER</button>`;  
    currentUser = null;  
    return;  
  }  
  
  currentUser = user;  
  
  // Listen to RBX balance  
  const balRef = ref(db, `users/${user.uid}/rbxbalance`);  
  onValue(balRef, snap => {  
    balance = snap.exists() ? snap.val() : 0;  
    const bigBal = document.getElementById("bigBal");  
    if(bigBal) bigBal.innerText = balance + " RBX";  
    const rbxBtn = document.querySelector(".rbx");  
    if(rbxBtn) rbxBtn.innerText = balance + " RBX / GET";  
  });  
  
  headerRight.innerHTML = `  
    <div class="user-actions">  
      <div class="rbx" onclick="openWithdrawModal()">${balance} RBX / GET</div>  
      <img class="logout-icon" src="https://i.imgur.com/Lvfvc4a.png" onclick="toggleLogout()">  
      <div class="logout-menu" id="logoutMenu">  
        <button onclick="doLogout()">Logout</button>  
      </div>  
    </div>`;  
});  
  
// ====== Withdraw Modal Functions ======  
window.openWithdrawModal = () => { if(withdrawModal) withdrawModal.style.display = 'flex'; };  
  
window.confirmWithdraw = async () => {  
  const msg = document.getElementById("msg");  
  msg.className = "msg";  
  const robloxUser = document.getElementById("robloxUser");  
  const extraInfo = document.getElementById("extraInfo");  
  
  if(balance < 150){ msg.textContent = "You need at least 150 RBX"; msg.classList.add("error"); return; }  
  if(!robloxUser.value){ msg.textContent = "Please enter your Roblox username"; msg.classList.add("error"); return; }  
  
  await push(ref(db, `confirmedrbx/${currentUser.uid}`), {  
    amount: 150,  
    roblox: robloxUser.value,  
    info: extraInfo.value,  
    status: "pending",  
    time: Date.now()  
  });  
  msg.textContent = "Withdrawal submitted"; msg.classList.add("success");  
  robloxUser.value = ""; extraInfo.value = "";  
};  
  
// ====== Logout Functions ======  
window.toggleLogout = () => {   
  const menu = document.getElementById("logoutMenu");   
  if(menu) menu.classList.toggle('show');   
};  
  
window.doLogout = async () => { await signOut(auth); location.reload(); };  
  
// ====== Top Sections Clicks ======  
sections.forEach(section => {  
  const label = section.querySelector('span').innerText;  
  
  if(label === "Redeem rewards"){  
    section.addEventListener('click', openWithdrawModal);  
  }  
  
  if(label === "Refer & Earn"){  
    section.addEventListener('click', () => {  
      if(!currentUser){  
        referMsg.textContent = "Login to get your referral link";  
        referLinkInput.value = "";  
      } else {  
        referMsg.textContent = "Share your link & earn 10 RBX per user!";  
        const link = `${location.origin}/refer?uid=${currentUser.uid}`;  
        referLinkInput.value = link;  
  
        const refRef = ref(db, `referrals/${currentUser.uid}`);  
        onValue(refRef, snap => {  
          let data = snap.exists() ? snap.val() : {users:0, clicks:0, rbx:0};  
          referStats.textContent = `Referred Users: ${data.users||0} | Clicks: ${data.clicks||0} | RBX Earned: ${data.rbx||0}`;  
        });  
      }  
      referModal.style.display = 'flex';  
    });  
  }  
});  
  
// ====== Copy Referral Link ======  
copyReferBtn?.addEventListener('click', () => {  
  if(!referLinkInput.value) return;  
  navigator.clipboard.writeText(referLinkInput.value)  
    .then(() => showToast("Referral link copied!"))  
    .catch(()=> showToast("Failed to copy link"));  
});  
  
// ====== Global Click & Escape ======  
window.addEventListener('click', e => {  
  if(e.target === withdrawModal) withdrawModal.style.display = 'none';  
  if(e.target === referModal) referModal.style.display = 'none';  
  const menu = document.getElementById("logoutMenu");  
  if(menu && !menu.contains(e.target) && e.target.closest('.logout-icon')===null) menu.classList.remove('show');  
});  
  
window.addEventListener('keydown', e => {  
  if(e.key === 'Escape') {  
    if(withdrawModal) withdrawModal.style.display='none';  
    if(referModal) referModal.style.display='none';  
  }  
});  
  
/* ================= VIDEO PLAYER ================= */
(() => {
  const originalVideos = [
    "https://files.catbox.moe/61ny1y.mp4",
    "https://files.catbox.moe/jfapxh.mp4",
    "https://files.catbox.moe/vqvviq.mp4",
    "https://files.catbox.moe/69l5y3.mp4",
    "https://files.catbox.moe/bjwdo9.mp4",
    "https://storage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"
  ];

  let shuffledVideos = [...originalVideos].sort(() => Math.random() - 0.5);
  let currentIndex = 0;

  let videoDuration = 0;
  let videoCompleted = false;

  const player = document.getElementById('player');
  const startBtn = document.getElementById('startBtn');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const progressBar = document.getElementById('progressBar');
  const timeCounter = document.getElementById('timeCounter');
  const rewardNumber = document.getElementById('rewardNumber');
  const rewardPopup = document.getElementById('rewardPopup');
  const rewardMessage = document.getElementById('rewardMessage');
  const rewardOkButton = document.getElementById('rewardOkButton');
  const loaderPill = document.getElementById('loaderPill');

  /* ================= CORE ================= */

  function loadVideo(index) {
    videoCompleted = false;

    progressBar.style.width = '0%';
    timeCounter.textContent = '0:00';
    rewardNumber.textContent = '0';

    player.pause();
    player.currentTime = 0;
    player.src = shuffledVideos[index];
    player.load();

    startBtn.style.display = 'block';
  }

  /* ================= VIDEO META ================= */

  player.addEventListener('loadedmetadata', () => {
    videoDuration = Math.floor(player.duration);
    if (!videoDuration || isNaN(videoDuration)) return;

    rewardNumber.textContent = Math.ceil(videoDuration / 10);
  });

  /* ================= START ================= */

  startBtn.addEventListener('click', async () => {
    startBtn.style.display = 'none';
    try {
      await player.play();
    } catch {
      startBtn.style.display = 'block';
    }
  });

  /* ================= HEARTBEAT (THE ONLY TIMER) ================= */

  player.addEventListener('timeupdate', () => {
    if (!videoDuration) return;

    const watched = Math.floor(player.currentTime);
    const remaining = Math.max(videoDuration - watched, 0);

    // Countdown
    timeCounter.textContent =
      `${Math.floor(remaining / 60)}:${String(remaining % 60).padStart(2, '0')}`;

    // Progress bar
    progressBar.style.width =
      (watched / videoDuration * 100) + '%';

    // Completion flag
    if (remaining === 0) {
      videoCompleted = true;
    }
  });

  /* ================= END / REWARD ================= */

  player.addEventListener('ended', () => {
    if (!videoCompleted) return;

    const earned = Math.ceil(videoDuration / 10);
    rewardMessage.textContent = `You earned ${earned} RBX`;
    rewardPopup.style.display = 'flex';
    saveRBXReward(earned);
  });

  rewardOkButton.addEventListener('click', () => {
    rewardPopup.style.display = 'none';
    nextVideo();
  });

  /* ================= NAVIGATION ================= */

  function nextVideo() {
    currentIndex = (currentIndex + 1) % shuffledVideos.length;
    loadVideo(currentIndex);
  }

  function prevVideo() {
    currentIndex =
      (currentIndex - 1 + shuffledVideos.length) % shuffledVideos.length;
    loadVideo(currentIndex);
  }

  nextBtn.addEventListener('click', nextVideo);
  prevBtn.addEventListener('click', prevVideo);

  /* ================= LOADER ================= */

  player.addEventListener('waiting', () => {
    loaderPill.style.display = 'block';
  });

  player.addEventListener('playing', () => {
    loaderPill.style.display = 'none';
  });

  /* ================= RBX SAVE (SAFE) ================= */

  function saveRBXReward(earned) {
    const user = auth.currentUser;
    if (!user) return;

    const balRef = ref(db, `users/${user.uid}/rbxbalance`);
    runTransaction(balRef, current => (current || 0) + earned)
      .catch(err => console.error("RBX update failed:", err));
  }

  /* ================= INIT ================= */

  loadVideo(currentIndex);
})();
rewardPopup.style.display = 'none'; // ensure hidden on page load
rewardMessage.textContent = '';     // clear any text
// ====== TOP EARNERS ======
const topUsersContainer = document.getElementById('topUsers');

function loadTopEarners() {
  const usersRef = ref(db, 'users');
  
  onValue(usersRef, snap => {
    topUsersContainer.innerHTML = ''; // clear first

    if (!snap.exists()) {
      topUsersContainer.innerHTML = '<div style="color:#fff;">No users found</div>';
      return;
    }

    const usersData = snap.val();

    const sortedUsers = Object.entries(usersData)
      .map(([uid, user]) => {
        let displayName = 'Anonymous';
        if(user.username) displayName = user.username;
        else if(user.email) displayName = user.email.split('@')[0];

        return {
          uid,
          name: displayName,
          rbx: Number(user.rbxbalance) || 0
        };
      })
      .filter(u => u.rbx > 0)
      .sort((a, b) => b.rbx - a.rbx);

    if(sortedUsers.length === 0){
      topUsersContainer.innerHTML = '<div style="color:#fff;">No RBX earned yet</div>';
      return;
    }

    const topProfiles = [
      'https://tr.rbxcdn.com/a151bf7f30dcbda63284a6fdb2f52850/512/512/Image/Png',
      'https://www.gamepur.com/wp-content/uploads/2022/10/03141118/Rich-Roblox-Characters-Avatar-Design-Idea-Outfit.jpg?w=1200',
      'https://art.ngfiles.com/images/2793000/2793270_fotheplant_roblox-noob-plushie.png?f1666352152'
    ];

    const buttonColors = ['gold', 'cyan', 'brown'];

    sortedUsers.slice(0,3).forEach((u,i)=>{
      const card = document.createElement('div');
      card.style.cssText = `
        display:flex;
        align-items:center;
        justify-content:space-between;
        padding:12px 16px;
        border-radius:12px;
        margin-bottom:6px;
        color:#fff;
        font-family: -apple-system, BlinkMacSystemFont, 'SF Pro', sans-serif;
        background: rgba(255,255,255,0.05);
      `;

      card.innerHTML = `
        <div style="display:flex; align-items:center; gap:10px;">
          <img src="${topProfiles[i]}" 
               alt="profile" 
               style="width:32px; height:32px; border-radius:50%;">
          <span>#${i+1} ${u.name}</span>
        </div>
        <button id="donateBtn-${u.uid}" style="
          padding:6px 12px;
          border-radius:8px;
          border:1px solid ${buttonColors[i]};
          background: rgba(0,0,0,0.6);
          color:#fff;
          cursor:pointer;
        ">Donate</button>
      `;

      topUsersContainer.appendChild(card);

      document.getElementById(`donateBtn-${u.uid}`).onclick = () => {
        onAuthStateChanged(auth, user => {
          if(!user) return showModal('<h3>Login Required</h3><p>Please log in to donate RBX.</p>');
          if(user.uid === u.uid) return showModal('<h3>Error</h3><p>You cannot donate to yourself.</p>');

          const donorUid = user.uid;
          const donorRef = ref(db, `users/${donorUid}/rbxbalance`);
          const recipientRef = ref(db, `users/${u.uid}/rbxbalance`);

          get(donorRef).then(snap2 => {
            const donorRbx = Number(snap2.val() || 0);

            showModal(`
              <h3>Donate to ${u.name}</h3>
              <p>Your RBX: ${donorRbx}</p>
              <input id="donateAmount" type="number" placeholder="Enter amount" style="width:100%; padding:6px; margin-top:8px;"/>
              <button id="sendDonateBtn" style="margin-top:8px; padding:6px 12px;">Send</button>
            `);

            document.getElementById('sendDonateBtn').onclick = () => {
              const rawValue = document.getElementById('donateAmount').value.trim();

              // Only whole numbers allowed
              if(!/^\d+$/.test(rawValue)) return showModal('<h3>Error</h3><p>Only numbers allowed.</p>');

              const donateAmount = Number(rawValue);
              if(donateAmount < 1) return showModal('<h3>Error</h3><p>Amount must be at least 1 RBX.</p>');
              if(donorRbx < donateAmount) return showModal('<h3>Error</h3><p>Not enough RBX.</p>');

              donorRef.set(donorRbx - donateAmount);

              get(recipientRef).then(snap3 => {
                const recipientRbx = Number(snap3.val() || 0);
                recipientRef.set(recipientRbx + donateAmount);
              });

              push(ref(db, 'transactions'), {
                from: donorUid,
                to: u.uid,
                amount: donateAmount,
                timestamp: Date.now()
              });

              modal.style.display = 'none';
              loadTopEarners(); // refresh leaderboard
            };
          });
        });
      };
    });
  });
}

// iOS-style modal
function showModal(contentHtml) {
  let modal = document.getElementById('modalDonate');
  if(!modal){
    modal = document.createElement('div');
    modal.id='modalDonate';
    modal.style.cssText = `
      position:fixed; top:0; left:0; width:100%; height:100%;
      display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,0.6); z-index:9999;
    `;
    const inner = document.createElement('div');
    inner.id='modalContent';
    inner.style.cssText = `
      background:rgba(30,30,30,0.95); color:#fff;
      padding:20px; border-radius:16px; min-width:280px;
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro', sans-serif;
    `;
    modal.appendChild(inner);
    document.body.appendChild(modal);

    modal.onclick = (e) => { if(e.target===modal) modal.style.display='none'; };
  }
  document.getElementById('modalContent').innerHTML = contentHtml;
  modal.style.display = 'flex';
}

// Load leaderboard
loadTopEarners();
// Call it once on load
loadTopEarners();
const commentInput = document.getElementById('commentInput');
const submitCommentBtn = document.getElementById('submitComment');
const topCommentsContainer = document.getElementById('topComments');

// Submit comment
submitCommentBtn.addEventListener('click', async () => {
  const user = auth.currentUser;
  if(!user){
    showToast("You must be logged in to comment");
    return;
  }
  const text = commentInput.value.trim();
  if(!text) return;

  const commentRef = ref(db, 'comments');
  await push(commentRef, {
    uid: user.uid,
    username: user.displayName || user.email.split('@')[0],
    comment: text,
    likes: 0,
    status: "pending", // must be approved by owner
    timestamp: Date.now()
  });

  commentInput.value = '';
  showToast("Comment submitted for approval");
});
// Load top 5 approved comments with custom profile image and tick
function loadTopComments() {
  const commentsRef = ref(db, 'comments');
  onValue(commentsRef, snap => {
    topCommentsContainer.innerHTML = '';
    if (!snap.exists()) return;

    const allComments = Object.values(snap.val())
      .filter(c => c.status === "approved")
      .sort((a, b) => b.likes - a.likes || b.timestamp - a.timestamp)
      .slice(0, 5);

    allComments.forEach(c => {
      const timeAgo = formatTimeAgo(c.timestamp);

      const commentCard = document.createElement('div');
      commentCard.style.cssText = `
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        margin: 10px 0;
        color: #fff;
        font-family: -apple-system, BlinkMacSystemFont, 'SF Pro', sans-serif;
      `;

      commentCard.innerHTML = `
        <div style="display:flex; align-items:center; gap:6px; font-weight:700; color:#00ffcc;">
          <img src="https://play-lh.googleusercontent.com/ZvHfv7uuqNMHSnAySfy2VU1mQKkxjAsp6oSakhPl6-jIJuoNEy-bypkdYtfXv7CcCXQ" 
               alt="profile" 
               style="width:24px; height:24px; border-radius:50%;">
          ${c.username} 
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" 
               fill="#00ffcc" width="16" height="16">
            <path d="M20.285 6.709a1 1 0 0 0-1.414-1.418L9 15.168l-3.87-3.87a1 1 0 0 0-1.415 1.414l4.577 4.577a1 1 0 0 0 1.414 0l10.579-10.58z"/>
          </svg>
          <span style="font-weight:400; color:#ccc; font-size:0.8rem;">• ${timeAgo}</span>
        </div>
        <div style="margin-top:4px;">${c.comment}</div>
      `;
      topCommentsContainer.appendChild(commentCard);
    });
  });
}


// Utility: human-readable time
function formatTimeAgo(timestamp){
  const now = Date.now();
  const diff = now - timestamp;
  const minutes = Math.floor(diff / 60000);
  const hours = Math.floor(diff / 3600000);
  const days = Math.floor(diff / 86400000);

  if(days>0) return `${days} day${days>1?'s':''} ago`;
  if(hours>0) return `${hours} hour${hours>1?'s':''} ago`;
  if(minutes>0) return `${minutes} min${minutes>1?'s':''} ago`;
  return "just now";
}

// Call on load
loadTopComments();
const faqData = [
  { question: "How do I earn RBX?", answer: "Watch videos, complete tasks, and refer friends to earn RBX rewards." },
  { question: "When can I withdraw my RBX?", answer: "You can withdraw once you reach the minimum of 150 RBX." },
  { question: "Do I need a Roblox username?", answer: "Yes, you must provide your Roblox username to claim withdrawals." },
  { question: "Can I refer multiple friends?", answer: "Absolutely! Each friend who signs up via your referral link earns you 10 RBX." },
  { question: "Is there a limit to daily rewards?", answer: "There’s no limit, but video availability may vary." }
];

function loadFAQ() {
  const container = document.getElementById('faqContainer');
  container.innerHTML = ''; // Clear existing content

  faqData.forEach(item => {
    const faqCard = document.createElement('div');
    faqCard.style.cssText = `
      background: #000;        /* Full black background */
      border-radius: 16px;
      padding: 12px 16px;
      cursor: pointer;
      margin-bottom: 12px;
      color: #fff;
      text-shadow: none;
      box-shadow: none;
      transition: transform 0.2s ease;
    `;

    faqCard.innerHTML = `
      <div style="font-weight:700; color:#fff; display:flex; justify-content:space-between; align-items:center;">
        <span>${item.question}</span>
        <span style="transition:0.3s;" class="arrow">&#9656;</span>
      </div>
      <div style="margin-top:8px; font-size:0.95rem; color:#fff; display:none;" class="answer">
        ${item.answer}
      </div>
    `;

    faqCard.addEventListener('click', () => {
      const answer = faqCard.querySelector('.answer');
      const arrow = faqCard.querySelector('.arrow');
      if (answer.style.display === 'none') {
        answer.style.display = 'block';
        arrow.style.transform = 'rotate(90deg)';
      } else {
        answer.style.display = 'none';
        arrow.style.transform = 'rotate(0deg)';
      }
    });

    container.appendChild(faqCard);
  });
}

// Call this wherever you want in your main script
loadFAQ();
</script>  
</body>  
</html>