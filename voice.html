<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI ANALYZER</title>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #0a0a0a, #1a1a1a);
      color: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 3rem 1rem;
      min-height: 100vh;
    }
    .container {
      width: 100%;
      max-width: 450px;
      background: rgba(255,255,255,0.05);
      border-radius: 24px;
      padding: 2rem 2rem 3rem;
      box-shadow: 0 0 20px rgba(255,59,48,0.3);
      backdrop-filter: blur(25px);
      text-align: center;
    }
    h1 {
      font-weight: 900;
      font-size: 2.8rem;
      letter-spacing: 0.15em;
      margin: 0 0 0.4rem;
      color: #ff3b30;
      text-shadow:
        0 0 8px #ff3b30,
        0 0 12px #ff3b30,
        0 0 18px #ff3b30;
      user-select: none;
    }
    p {
      font-weight: 400;
      font-size: 1rem;
      margin: 0 0 1.8rem;
      color: #bbb;
    }
    input, button {
      width: 100%;
      padding: 0.9rem 1rem;
      font-size: 1.1rem;
      border-radius: 14px;
      border: none;
      outline: none;
      margin-bottom: 1.2rem;
      box-sizing: border-box;
    }
    input {
      background: rgba(255,255,255,0.1);
      color: #fff;
      font-weight: 500;
      border: 1.5px solid rgba(255,255,255,0.2);
      transition: border-color 0.3s;
    }
    input:focus {
      border-color: #ff3b30;
      background: rgba(255,255,255,0.15);
    }
    button {
      background: #ff3b30;
      color: #fff;
      font-weight: 700;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s;
    }
    button:hover:not(:disabled) {
      background: #ff1e17;
    }
    button:disabled {
      background: #aa2923;
      cursor: not-allowed;
    }
    #result {
      margin-top: 1rem;
      min-height: 120px;
      color: #ddd;
    }
    /* Spinner animation */
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .spinner {
      margin: 2rem auto;
      border: 4px solid rgba(255,255,255,0.1);
      border-top: 4px solid #ff3b30;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      animation: spin 1s linear infinite;
    }
    img.thumb {
      width: 100%;
      border-radius: 14px;
      margin-top: 1rem;
      user-select: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>✨ AI ANALYZER ✨</h1>
    <p>Enter YouTube video URL to analyze title & thumbnails</p>
    <input type="text" id="videoInput" placeholder="Paste YouTube link or ID" />
    <button onclick="fetchVideo()">Analyze Now</button>
    <div id="result"></div>
  </div>

<script>
  const input = document.getElementById('videoInput');
  const result = document.getElementById('result');
  const button = document.querySelector('button[onclick="fetchVideo()"]');

  // Sanitize text to avoid HTML injection in inputs
  function escapeHtml(text) {
    return text.replace(/[&<>"']/g, function(m) {
      return ({
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;'
      })[m];
    });
  }

  function getVideoID(inputVal) {
    try {
      const url = new URL(inputVal);
      return url.searchParams.get("v") || url.pathname.split("/").pop();
    } catch {
      return inputVal; // assume ID
    }
  }

  function analyzeTitle(title) {
    const lowered = title.toLowerCase();
    if (lowered.includes("how to") || lowered.includes("tutorial")) return "Educational";
    if (lowered.includes("shocking") || lowered.includes("you won’t believe")) return "Clickbait";
    if (lowered.includes("review") || lowered.includes("unboxing")) return "Product-Based";
    if (lowered.includes("trending") || lowered.includes("viral")) return "Trendy";
    return "General";
  }

  function createSpinner() {
    return `<div class="spinner" style="
      margin: 2rem auto; 
      border: 4px solid rgba(255,255,255,0.1); 
      border-top: 4px solid #ff3b30; 
      border-radius: 50%; 
      width: 36px; 
      height: 36px; 
      animation: spin 1s linear infinite;
      ">
      </div>`;
  }

  async function fetchVideo() {
    const val = input.value.trim();
    if (!val) {
      alert("Please enter a YouTube video URL or ID.");
      return;
    }

    let percent = 0;
    button.disabled = true;
    input.disabled = true;

    button.textContent = `Analyzing... 0%`;
    const interval = setInterval(() => {
      if (percent < 90) {
        percent += Math.floor(Math.random() * 5) + 1;
        if (percent > 90) percent = 90;
        button.textContent = `Analyzing... ${percent}%`;
      }
    }, 100);

    result.innerHTML = createSpinner();

    const videoID = getVideoID(val);
    const thumbs = {
      max: `https://img.youtube.com/vi/${videoID}/maxresdefault.jpg`,
    };

    try {
      const res = await fetch(`https://corsproxy.io/?https://www.youtube.com/watch?v=${videoID}`);
      const html = await res.text();
      const title = html.match(/<title>(.*?)<\/title>/)?.[1]?.replace(" - YouTube", "") || "Unknown Title";
      const label = analyzeTitle(title);

      clearInterval(interval);
      button.textContent = "Analyzing... 100%";

      setTimeout(() => {
        button.textContent = "Analyze Now";
        button.disabled = false;
        input.disabled = false;

        result.innerHTML = `
          <div style="margin-top: 1rem; text-align: center;">
            <input 
              id="titleInput" 
              type="text" 
              value="${escapeHtml(title)}" 
              style="width: 100%; padding: 0.6rem 1rem; font-size: 1rem; border-radius: 10px; border: 1.5px solid rgba(255,255,255,0.2); margin-bottom: 1rem; background: rgba(255,255,255,0.1); color: #fff;"
              placeholder="Edit title here"
            />
            <textarea
              id="descriptionInput"
              rows="3"
              placeholder="Add your description here"
              style="width: 100%; padding: 0.6rem 1rem; font-size: 1rem; border-radius: 10px; border: 1.5px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.1); color: #fff; resize: vertical;"
            ></textarea>

            <img src="${thumbs.max}" alt="Thumbnail" style="width: 100%; border-radius: 12px; margin-top: 1rem;" onerror="this.style.display='none'" />

            <div style="margin-top: 1rem; display: flex; justify-content: center; gap: 1rem;">
              <button id="downloadBtn" style="
                background:#ff3b30; color:#fff; border:none; border-radius:10px; padding:0.6rem 1rem; cursor:pointer;
              ">Download Thumbnail</button>
            </div>
          </div>
        `;

        document.getElementById('downloadBtn').onclick = () => {
          const a = document.createElement('a');
          a.href = thumbs.max;
          const filenameTitle = document.getElementById('titleInput').value.trim() || 'thumbnail';
          const safeFilename = filenameTitle.replace(/[^\w\d_-]/g, '_');
          a.download = `${safeFilename}_thumbnail.jpg`;
          document.body.appendChild(a);
          a.click();
          a.remove();
        };

      }, 300);
    } catch (e) {
      clearInterval(interval);
      button.textContent = "Analyze Now";
      button.disabled = false;
      input.disabled = false;

      result.innerHTML = `<p style="color: #ff3b30; text-align:center; margin-top: 1rem;">
        ⚠️ Could not load data. Check video ID or URL.
      </p>`;
      console.error(e);
    }
  }
</script>
</body>
</html>